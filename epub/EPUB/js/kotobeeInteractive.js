var _kInteractiveCommon;function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var kInteractive={preRender:function(e,t){t||(t={});var n,i=t.singleElem,a=e||document;i?(n=[e],a=document):n=a.getElementsByClassName("kInteractive"),"undefined"!=typeof isKotobee&&(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl(t));for(var r=n.length;r--;){var s=n[r];this.hasClass(s,"gallery")&&kInteractive.gallery.preRender(s,a,r),this.hasClass(s,"questions")&&kInteractive.questions.preRender(s,a,r),(this.hasClass(s,"image")||"img"==s.nodeName.toLowerCase())&&kInteractive.image.preRender(s,a,r),this.hasClass(s,"link")&&kInteractive.link.preRender(s,a,r),this.hasClass(s,"container")&&kInteractive.container.preRender(s,a,r),this.hasClass(s,"equation")&&kInteractive.equation.preRender(s,a,r),this.hasClass(s,"lipsync")&&kInteractive.lipsync.preRender(s,a,r)}},postRender:function(e,t){t||(t={});var n=t.singleElem;if(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl(t),kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.clocks&&(kInteractive.clocks=[]),kInteractive.observers){for(var i=kInteractive.observers.length;i--;)kInteractive.observers[i].disconnect();kInteractive.observers=null}kInteractive.clearAudioVideo(e),kInteractive.currentVideo=kInteractive.currentAudio=null;var a,r=e||document;n?(a=[e],r=document):a=r.getElementsByClassName("kInteractive");for(var s=a.length;s--;){var o=a[s],c=s;null!=t.forcedIndex&&(c=t.forcedIndex),this.hasClass(o,"container")?kInteractive.container.postRender(r,o,c,t):this.hasClass(o,"questions")?kInteractive.questions.postRender(r,o,c,t):this.hasClass(o,"widget")?kInteractive.widget.postRender(r,o,c,t):this.hasClass(o,"video")?kInteractive.video.postRender(r,o,c):this.hasClass(o,"audio")?kInteractive.audio.postRender(r,o,c):this.hasClass(o,"threed")?kInteractive.threed.postRender(r,o,c,t):this.hasClass(o,"gallery")?kInteractive.gallery.postRender(r,o,c):this.hasClass(o,"image")?kInteractive.image.postRender(r,o,c):this.hasClass(o,"equation")?kInteractive.equation.postRender(r,o,c):this.hasClass(o,"lipsync")&&kInteractive.lipsync.postRender(r,o,c)}this.firstRun&&(window.addEventListener("resize",(function(t){kInteractive.resizeEvent(e,n)})),this.firstRun=!1),kInteractive.resizeEvent(e,n)},getAbsoluteUrl:function(e){e||(e={});var t="";return"undefined"!=typeof isKotobee&&(t=e.chapterUrl?e.chapterUrl:stg.data.book.chapter.absoluteURL),"/"==t[0]&&(t=window.location.origin+t),t},actionEvent:function(e){return kInteractive.action(e.target,e)},action:function(e,t){if(!kInteractive.isEditorMode()){for(kInteractive.absoluteURL=kInteractive.getAbsoluteUrl();!e.className.trim;)e=e.parentNode;for(var n=e;!this.hasClass(n,"kInteractive");){if(!n.parentNode)return;if((n=n.parentNode)==document.body)return}return this.hasClass(n,"questions")?kInteractive.questions.action(n,e,t):this.hasClass(n,"widget")?kInteractive.widget.action(n):this.hasClass(e,"link")?kInteractive.link.action(n,e,t):this.hasClass(e,"image")?kInteractive.image.action(n,e,t):this.hasClass(n,"gallery")?kInteractive.gallery.action(n,e,t):this.hasClass(n,"audio")?kInteractive.audio.action(n,e,t):this.hasClass(n,"video")?kInteractive.video.action(n,e,t):this.hasClass(n,"threed")?kInteractive.threed.action(n,e,t):this.hasClass(n,"equation")?kInteractive.equation.action(n,e,t):this.hasClass(n,"lipsync")?kInteractive.lipsync.action(n,e,t):void 0}},trigger:function(e,t){this.action(t,e)},resize:function(e,t){kInteractive.resizeEvent(e,t)},resizeEvent:function(e,t){var n=e||document;t&&(n=document);for(var i=n.getElementsByClassName("kInteractive"),a=i.length;a--;){var r=i[a];this.hasClass(r,"image")?kInteractive.image.resize(r):this.hasClass(r,"gallery")?kInteractive.gallery.resize(r):this.hasClass(r,"container")?kInteractive.container.resize(r):this.hasClass(r,"video")?kInteractive.video.resize(r):this.hasClass(r,"widget")?kInteractive.widget.resize(r):this.hasClass(r,"equation")?kInteractive.equation.resize(r):this.hasClass(r,"questions")&&kInteractive.questions.resize(r)}},helpers:{},vQueue:[],youTubeReady:!1,firstRun:!0,scorm:"undefined"!=typeof scorm?scorm:null,events:"undefined"!=typeof events?events:null};if("undefined"==typeof isKotobee){var getKotobeeListener=function(e){if(e)for(var t=kotobeeListeners.length;t--;)if(kotobeeListeners[t].event==e)return kotobeeListeners[t]},clearKotobeeListeners=function(e){for(var t=kotobeeListeners.length;t--;)e&&kotobeeListeners[t].event!=e||kotobeeListeners.splice(t,1)},dispatchKotobeeEvent=function(){},kInteractionStart=function(){window.log||(window.log=function(e){}),kInteractive.setDOMParser(),renderMiniapps(),kInteractive.preRender(),kInteractive.postRender()},kInteractionStartSingleElem=function(e,t){kInteractive.setDOMParser(),kInteractive.preRender(e,{singleElem:!0}),kInteractive.postRender(e,{singleElem:!0,forcedIndex:t})},renderMathJax=function(){MathJax&&MathJax.typeset&&MathJax.typeset()},renderMiniapps=function renderMiniapps(){try{if(window.top&&window.top.document&&window.top.document.body&&"kAuthor"==window.top.document.body.id)return}catch(e){}var chapterBody=document.body.textContent;window.miniapps={test:2},window.miniappsConfig={};var kmetaRoot=getRelativeRoot()+"_kmeta/",appids=[],scriptElem=document.createElement("script");function getRelativeRoot(){var e=window.location.href.split("/");e=e.reverse();for(var t="",n=0;n<e.length&&"EPUB"!=e[n];n++)t+="../";return t}function validate(e,t){for(var n,i=document.getElementsByTagName("meta"),a=0;a<i.length;a++)if(i[a].getAttribute("name")=="m-"+window.atob("Y2hlY2tzdW0=")){n=i[a];break}if(kInteractive.isSDK())return!0;if(!n)return!1;var r=e.join(";"),s=t.replace(/\s+/g,"");return kInteractive.simpleHash(s+r)==n.getAttribute("content")}scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(result){var json=miniappJson.apps,arr=[];for(var item in json)arr.push({folder:item,code:json[item]});if(arr.length){var miniappContainer=document.createElement("div");miniappContainer.id="kiMiniappContainer",miniappContainer.innerHTML="<a href='' class='closeBtn'>X</a>",miniappContainer.getElementsByClassName("closeBtn")[0].addEventListener("click",toggleMiniappsContainer);var miniappsBtn=document.createElement("a");miniappsBtn.id="kiMiniappsBtn",miniappsBtn.setAttribute("href",""),miniappsBtn.innerHTML="Apps",miniappsBtn.addEventListener("click",toggleMiniappsContainer),next(0)}function toggleMiniappsContainer(e){e&&e.preventDefault(),miniappContainer.classList.contains("open")?miniappContainer.classList.remove("open"):miniappContainer.classList.add("open")}function next(index){if(index>=1&&miniappJson.sdk)return finalize();if(index>=arr.length)return finalize();var folder=arr[index].folder,pageLang=document.documentElement.lang;pageLang=-1!=pageLang.indexOf("es")?"es":-1!=pageLang.indexOf("fr")?"fr":-1!=pageLang.indexOf("ar")?"ar":"en";var scriptElem=document.createElement("script");scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=function(){scriptElem.parentNode.removeChild(scriptElem);var configJson=window.miniappConfig;"string"==typeof configJson&&(configJson=JSON.parse(configJson));var appid=configJson.appid,code=arr[index].code,regex=new RegExp("{{"+appid+"Root}}","g");code=code.replace(regex,kmetaRoot+"miniapps/"+folder),code=code.replace(/{{www}}/g,kmetaRoot+"../.."),eval(code),appids.push(appid);var miniappObj={};if(miniappObj.config=miniappsConfig[folder],miniappObj.locale=configJson.locale,miniappObj.appid=appid,miniappObj.appClass=window.miniappOutput,miniappObj.name=configJson.locale[pageLang].name,miniappObj.icon=configJson.icon,!miniappObj.appClass.open)return next(++index);function finishedGettingDataJson(){scriptElem.parentNode.removeChild(scriptElem);var e=document.createElement("a");e.className="app";var t=miniappObj.name,n=kmetaRoot+"miniapps/"+folder+"/icon.png";window.miniappData&&(window.miniappData._listingName&&(t=window.miniappData._listingName),window.miniappData._listingIcon&&(n=kInteractive.isAbsolutePath(window.miniappData._listingIcon)?window.miniappData._listingIcon:kmetaRoot+"miniapps/"+folder+"/userdata/"+window.miniappData._listingIcon)),e.innerHTML='<p class="name">'+t+'</p><img class="icon" src="'+n+'"/>',miniappObj.appClass.externalLink&&(e.setAttribute("href",miniappObj.appClass.externalLink),e.setAttribute("target","_blank")),miniappContainer.appendChild(e),e.addEventListener("click",(function(){toggleMiniappsContainer(),miniappObj.appClass.externalLink||miniappObj.appClass.open()})),next(++index)}scriptElem=document.createElement("script"),scriptElem.type="text/javascript",document.body.appendChild(scriptElem),scriptElem.onload=finishedGettingDataJson,scriptElem.onerror=finishedGettingDataJson,scriptElem.src=kmetaRoot+"miniapps/"+folder+"/userdata/data.js"},scriptElem.src=kmetaRoot+"miniapps/"+folder+"/config.js"}function finalize(){(miniappJson.sdk||validate(appids,chapterBody))&&(document.body.appendChild(miniappsBtn),document.body.appendChild(miniappContainer))}},scriptElem.src=kInteractive.c.join(kmetaRoot,"miniapps.js")};window.kotobee={};var kotobeeListeners=[];document.addEventListener("DOMContentLoaded",(function(e){"undefined"!=typeof kotobeeReady&&kotobeeReady(e),document.dispatchEvent(new Event("kotobeeReady")),document.dispatchEvent(new Event("kotobeeChapterLoaded")),kotobee.dispatchEvent("ready"),kotobee.dispatchEvent("chapterLoaded"),document.addEventListener("scroll",(function(e){kotobee.dispatchEvent("scrolled",e)}))})),kotobee.addEventListener=function(){if(!(arguments.length<2)){var e,t=arguments[0],n={};2==arguments.length?e=arguments[1]:(n=arguments[1],e=arguments[2]),n.unique&&clearKotobeeListeners(t);var i={event:t,cb:e};kotobeeListeners.push(i)}},kotobee.dispatchEvent=function(e,t){if(e){var n=getKotobeeListener(e);n&&n.cb&&n.cb.apply(this,[t])}};try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}}function kPersister(e){this.enabled=!0,this.delegateEvents=!0,this.storage="cloud",this.root=document.body,this.interval=200,this.maxDataSize=0,this.book="",this.chapter="",this.data=[],this.text=[],this.number=[],this.radio=[],this.checkbox=[],this.textarea=[],this.dragdrop=[],this.callback=null,this.silentMode=!1,this.appendDataMode=!1,this.forceNotification=!1,this.saveGlobal=!1,this.isSaveGlobal=!1,this.listener=null,this.testMode=!1,this.enableUncheckRadio=!1,this.setRadioGroup=!0,this.messages={save:"Save",unsaved:"You have unsaved changes",saving:"Saving your responses ..",saved:"Changes has been saved!",dismiss:"Dismiss",lastSaved:"Last saved on",longDataError:"Some answers not saved (marked in red)"},this.design={placement:"bottom-right",unsaved:{color:"#fff",background:"#de7a7a"},success:{color:"#fff",background:"#14c39a"}},this.enable=function(e){this.enabled=!0,this.silentMode=e,this.renderInlineBar(),this.renderFloatingBar()},this.disable=function(){this.enabled=!1,n(".unsaved-changes-"+t.root.id)&&n(".unsaved-changes-"+t.root.id).classList.remove("show")},this.setOptions=function(e){var t=this;for(var n in e)"messages"==n?t.setMessages(e.messages):"design"==n?t.setDesign(e.design):t.hasOwnProperty(n)&&(t[n]=e[n],"root"==n&&(t[n].id=e[n].id||"_"+Math.random().toString(36).substr(2,9)))},this.setDesign=function(e){for(var t in e)this.design.hasOwnProperty(t)?(-1!=["placement"].indexOf(t)||e[t].color||e[t].background)&&(this.design[t]=e[t]):i("error",["invalid design state:",t])},this.setMessages=function(e){var t=this;for(var a in e)if(t.messages.hasOwnProperty(a)){if(t.messages[a]=e[a],n(".unsaved-changes-"+t.root.id)&&!kInteractive.isEditorMode()&&n(".unsaved-changes-"+t.root.id+" ."+a))if("button"==n(".unsaved-changes-"+t.root.id+" ."+a).nodeName.toLowerCase())try{n(".unsaved-changes-"+t.root.id+" ."+a).innerText=e[a]}catch(e){}else try{n(".unsaved-changes-"+t.root.id+" ."+a+" span").innerText=e[a]}catch(e){}}else i("error",["invalid message key:",a])},this.waitFor=function(e,t,n){var a=this;n=n||0,window[e]||0==e.indexOf("#")&&"undefined"!=typeof document&&document.querySelector(e)||0==e.indexOf(".")&&"undefined"!=typeof document&&document.querySelector(e)||"document.body"==e&&"undefined"!=typeof document&&document.body?t():n<3e3?setTimeout((function(){a.waitFor(e,t,n+100)}),100):(i("error",["unable to find:",e]),t&&t())},this.renderInlineBar=function(){var e=this;if(n(".persist-log-"+e.root.id)&&n(".persist-log-"+e.root.id).parentNode.removeChild(n(".persist-log-"+e.root.id)),e.silentMode&&!kInteractive.isEditorMode()){var t=e.getRootSelector();if(n(t)){var a=n(t);a.length&&(a=a[0]),a.insertAdjacentHTML("beforeend",'<div class="persist-log persist-log-'+e.root.id+'"><span class="saving" style="display:none;color:'+e.design.unsaved.background+'">'+e.messages.saving+'</span><span class="success" style="display:none;color:'+e.design.success.background+'">'+e.messages.lastSaved.trim()+" "+(new Date).toLocaleDateString()+'</span><span class="error" style="display:none"></span></div>')}else i("warn",["unable to find root selector:",t])}},this.renderFloatingBar=function(){var e=this;if(n(".unsaved-changes-"+e.root.id)&&n(".unsaved-changes-"+e.root.id).parentNode.removeChild(n(".unsaved-changes-"+e.root.id)),!e.silentMode&&!kInteractive.isEditorMode()){var t="",a="",r="",s=e.design.placement.split("-");if(s.length&&(r+=s[0]+":70px;"),s.length>1)switch(r+=s[1]+":0px;",s[1]){case"left":t="-",a="";break;case"right":t="",a="-";break;default:i("error",["invalid horizontal placement:",s[1]])}var o="#fff",c="#333";if("undefined"!=typeof kotobee){var l=document.querySelectorAll("#kotobee .tabs");l.length&&(o=getComputedStyle(l[0]).backgroundColor,c=getComputedStyle(l[0]).color)}var d='<style id="'+e.root.id+'-persister-styles">.unsaved-changes-'+e.root.id+"{"+r+";display:none;transform:translateX("+t+"100%);background:"+o+";color:"+c+"}.unsaved-changes-"+e.root.id+".show{display:block;transform: translateX("+a+"20px)}.unsaved-changes-"+e.root.id+" button{background-color:"+e.design.unsaved.background+";color:"+e.design.unsaved.color+"}.unsaved-changes-"+e.root.id+".success button{background-color:"+e.design.success.background+";color:"+e.design.success.color+"</style>";document.head.querySelector("#"+e.root.id+"-persister-styles")||document.head.insertAdjacentHTML("beforeend",d);var u=n(".perspectiveContainer")?n(".perspectiveContainer"):document.body;if(u){var p='<div class="unsaved-changes unsaved-changes-'+e.root.id+'"><div class="unsaved"><span>'+e.messages.unsaved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button> <button class="save-now">'+e.messages.save+'</button></div><div class="saving" style="display:none;"><svg width="20px" height="20px" style="background:none;float:left;margin-top:5px;margin-right:5px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="lds-rolling"><circle cx="50" cy="50" fill="none" stroke="#ffffff" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138" transform="rotate(149.879 50 50)"><animateTransform attributeName="transform" type="rotate" calcMode="linear" values="0 50 50;360 50 50" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animateTransform></circle></svg><span>'+e.messages.saving+'</span></div><div class="saved" style="display:none;"><span>'+e.messages.saved+'</span> <button class="dismiss">'+e.messages.dismiss+'</button></div><div class="notsaved" style="display:none;"><span></span> <button class="dismiss">'+e.messages.dismiss+"</button></div></div>";try{u.insertAdjacentHTML("afterbegin",p),e.waitFor(".unsaved-changes-"+e.root.id,(function(){n(".unsaved-changes-"+e.root.id+" .dismiss",!0)?n(".unsaved-changes-"+e.root.id+" .dismiss",!0).forEach((function(e){e.addEventListener("click",(function(e){n(e.currentTarget).parents(".unsaved-changes").classList.remove("show")}))})):i("error",["unable to find dismiss button!"]),n(".unsaved-changes-"+e.root.id+" .save-now")?n(".unsaved-changes-"+e.root.id+" .save-now").addEventListener("click",(function(){e.save()})):i("error",["unable to find save button!"])}))}catch(e){i("error",[e,p])}}else i("error",["unable to find suitable container!"])}},this.getRootSelector=function(){return t.root.id?"#"+t.root.id:"."+t.root.className.splice(" ").join(".")},this.setNotify=function(e){var t=this;t.enabled&&n(".unsaved-changes-"+t.root.id)&&!kInteractive.isEditorMode()&&(e&&e.constructor===Object&&Object.keys(e).length>0&&t.setOptions(e),n(".unsaved-changes-"+t.root.id).classList.contains("show")&&!n(".unsaved-changes-"+t.root.id).classList.contains("success")||t.updateNotification("reset"))},this.save=function(e){var t=this;if(t.enabled){t.collectInputs(),t.updateNotification("saving");var n=[];t.text&&t.text.forEach((function(e){e.id&&n.push(e)})),t.number&&t.number.forEach((function(e){e.id&&n.push(e)})),t.radio&&t.radio.forEach((function(e){e.id&&n.push(e)})),t.checkbox&&t.checkbox.forEach((function(e){e.id&&n.push(e)})),t.textarea&&t.textarea.forEach((function(e){e.id&&n.push(e)})),t.dragdrop&&t.dragdrop.forEach((function(e){e.dataset.category=Array.prototype.slice.apply(e.parentNode.classList).find((function(e){return-1!=e.indexOf("ki-dd-category")}))||"",e.id&&n.push(e)}));var i=n.map((function(e){var t;return t=-1!=["radio","checkbox"].indexOf(e.type)?e.checked:"div"==e.nodeName.toLowerCase()?e.dataset.category||"":e.value,{id:e.id,type:e.type||e.nodeName.toLowerCase(),value:t}}));if(this.appendDataMode)for(var a=0;a<t.data.length;a++){var r=t.data[a],s=i.find((function(e){return e.id==r.id}));s?Object.assign(r,s):i.push(r)}t.setLocalData(i,(function(){"cloud"==t.storage&&kInteractive.isKotobeeUser()&&"undefined"!=typeof isKotobee?t.push(e):(t.updateNotification("success"),e&&e())}))}},this.setLocalData=function(e,t){var n=this,i={label:kInteractive.getChapterID()+"-"+n.root.id,data:JSON.stringify(e),overwrite:!0};kInteractive.setLocalData(i,(function(e){window.unsaved="cloud"==n.storage,"cloud"!=n.storage&&n.updateNotification("success");var i={target:n};e.error?i.error=e.error:i.result=e,n.listener.emit("persister.saved",i),"function"==typeof t&&t()}))},this.getLocalData=function(){var e=this;return new Promise((function(t){if("cloud"==e.storage&&"undefined"!=typeof isKotobee&&kInteractive.isKotobeeUser())try{kotobee.getData({label:kInteractive.getChapterID()+"-"+e.root.id},(function(n){n.length?(e.merge(n),i()):(e.data=[],t())}))}catch(n){e.listener.emit("persister.error",n.toString()),t()}else kInteractive.getLocalDataArray([{}],(function(t){t.length?kInteractive.setLocalDataArray(e.cleanupData(t).map((function(e){return Object.assign(e,{overwrite:!0})})),i):i()}));function i(){kInteractive.getLocalData({label:kInteractive.getChapterID()+"-"+e.root.id},(function(i){if(Array.isArray(i)){if(i.length)try{e.data=JSON.parse(i[0].data)}catch(t){e.data=[],n("body.cke_editable")||e.listener.emit("persister.error",{target:e,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+e.root.id+'": '+JSON.stringify(i)})}else e.data=[];t()}else n("body.cke_editable")||e.listener.emit("persister.error",{target:e,error:'invalid or empty slot for "'+kInteractive.getChapterID()+"-"+e.root.id+'": '+JSON.stringify(i)})}))}}))},this.cleanupData=function(e){return Array.isArray(e)?e.slice(0).sort((function(e,t){return e.date>t.date?-1:e.date<t.date?1:0})).filter((function(e,t,n){return n.findIndex((function(t){return t.label==e.label}))==t})):(i("error",["invalid data:",e]),[])},this.clear=function(e){var t=this;function n(n){i("warn",[n]),window.unsaved=!1;var a={target:t};n.error?a.error=n.error:a.result=n,t.listener.emit("persister.unsaved",a),"function"==typeof e&&e()}kInteractive.deleteLocalData({label:kInteractive.getChapterID()+"-"+t.root.id},(function(e){e.success&&("cloud"==t.storage&&kInteractive.isKotobeeUser()?kotobee.deleteData({label:kInteractive.getChapterID()+"-"+t.root.id},(function(e){e.success&&n(e)})):n(e))}))},this.merge=function(e){var t=this;if(e.length>1){var n=e.sort((function(e,t){return e.date>t.date?-1:e.date<t.date?1:0}));i("warn",["duplicate slots:",n]);var a=n[0];i("warn",["deleting all slots matching",a.label]),kotobee.deleteData({label:a.label,all:!0},(function(e){i("warn",[e]),i("warn",["insert only last slot for",a.label]),kotobee.setData(a,(function(e){i("warn",[e])}))}))}var r=t.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]",s=(r=JSON.parse(r)).findIndex((function(e){return e.label==kInteractive.getChapterID()+"-"+t.root.id}));-1!=s&&r.splice(s,1),r=r.concat(e),r=t.cleanupData(r),t.storageAPI.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(r))},this.push=function(e){var t=this;if(t.enabled){var a=t.storageAPI.getItem("ebook-"+kInteractive.getBookID())||"[]";if(a=(a=JSON.parse(a)).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.overwrite=!0,delete t.date,t})),"cloud"==t.storage&&kInteractive.isKotobeeUser())try{var r=t.cleanupData(a),s=r;s.forEach((function(e){JSON.parse(e.data).forEach((function(e){var t=n("#"+e.id);t&&t.classList.remove("inputError")}))}));r.filter((function(e){return e.data.length>t.maxDataSize}));var o=[];0,kotobee.setDataArray(s,(function(n){i("warn",[n]),c(e,n.error||(o.length?t.messages.longDataError:null))}))}catch(t){c(e,t.toString())}else c(e)}function c(e,n){window.unsaved=!1,n?(t.updateNotification("error",n),t.listener.emit("persister.error",{target:t,error:n})):(t.updateNotification("success"),t.listener.emit("persister.pushed",{target:t,result:{success:"pushed"}}),t.isSaveGlobal?("function"==typeof t.saveGlobal?t.saveGlobal():"object"==_typeof(t.saveGlobal)&&t.saveGlobal.hasOwnProperty("callback")&&t.saveGlobal.callback(),t.isSaveGlobal=!1):"function"==typeof e&&e())}},this.updateNotification=function(e,t){var i=this;try{if(i.enabled&&!kInteractive.isEditorMode())if(n(".persist-log-"+i.root.id)&&i.silentMode)switch(e){case"saving":n(".persist-log-"+i.root.id+" span.saving").style.display="block",n(".persist-log-"+i.root.id+" span.success").style.display="none",n(".persist-log-"+i.root.id+" span.error").style.display="none";break;case"success":n(".persist-log-"+i.root.id+" span.saving").style.display="none",n(".persist-log-"+i.root.id+" span.success").style.display="block",n(".persist-log-"+i.root.id+" span.error").style.display="none";break;case"error":n(".persist-log-"+i.root.id+" span.saving").style.display="none",n(".persist-log-"+i.root.id+" span.success").style.display="none",n(".persist-log-"+i.root.id+" span.error").style.display="block",n(".persist-log-"+i.root.id+" span.error").textContent=t||"Unexpected error!"}else if(n(".unsaved-changes-"+i.root.id))switch(e){case"saving":n(".unsaved-changes-"+i.root.id+" .saved").style.display="none",n(".unsaved-changes-"+i.root.id+" .saving").style.display="block",n(".unsaved-changes-"+i.root.id+" .unsaved").style.display="none",n(".unsaved-changes-"+i.root.id+" .notsaved").style.display="none",n(".unsaved-changes-"+i.root.id).classList.contains("success")&&n(".unsaved-changes-"+i.root.id).classList.remove("success"),i.silentMode||n(".unsaved-changes-"+i.root.id).classList.contains("show")||n(".unsaved-changes-"+i.root.id).classList.add("show");break;case"success":n(".unsaved-changes-"+i.root.id+" .saving").style.display="none",i.silentMode||i.isSaveGlobal?n(".unsaved-changes-"+i.root.id).classList.remove("show"):(n(".unsaved-changes-"+i.root.id).classList.add("success"),n(".unsaved-changes-"+i.root.id+" .saved").style.display="block");break;case"error":n(".unsaved-changes-"+i.root.id+" .saving").style.display="none",i.silentMode||i.isSaveGlobal?n(".unsaved-changes-"+i.root.id).classList.remove("show"):(n(".unsaved-changes-"+i.root.id).classList.add("error"),n(".unsaved-changes-"+i.root.id+" .notsaved span").textContent=t||"Unexpected error!",n(".unsaved-changes-"+i.root.id+" .notsaved").style.display="block");break;case"reset":n(".unsaved-changes-"+i.root.id+" .saved").style.display="none",n(".unsaved-changes-"+i.root.id+" .saving").style.display="none",n(".unsaved-changes-"+i.root.id+" .unsaved").style.display=i.silentMode?"none":"block",n(".unsaved-changes-"+i.root.id+" .notsaved").style.display="none",n(".unsaved-changes-"+i.root.id).classList.contains("success")&&n(".unsaved-changes-"+i.root.id).classList.remove("success"),i.silentMode||n(".unsaved-changes-"+i.root.id).classList.contains("show")||n(".unsaved-changes-"+i.root.id).classList.add("show")}}catch(e){}},this.collectInputs=function(){var e=this,t=this.getRootSelector();e.root=n(t),e.root?(e.text=n(e.root).find('input[type="text"]',!0),e.number=n(e.root).find('input[type="number"]',!0),e.radio=n(e.root).find('input[type="radio"]',!0),e.checkbox=n(e.root).find('input[type="checkbox"]:not([name="preserveAnswers"])',!0),e.textarea=n(e.root).find("textarea",!0),e.dragdrop=n(e.root).find(".ki-draggable",!0)):i("error",["unable to re-select root element by:",t])},this.handleChange=function(){var e=this;e.enabled&&(e.silentMode?e.save():e.saveGlobal&&!e.forceNotification||e.setNotify())},this.processInputs=function(){var e=this;function t(){i("warn",["persister change handler:",this.id,-1!=["radio","checkbox"].indexOf(this.type)?this.checked:this.value]),e.handleChange()}function n(n,i){document.body.addEventListener(n,(function(n){var a,r,s,o;n.target.id==i.id&&(-1!=["radio","checkbox"].indexOf(i.type)?i.checked=n.target.checked:i.value=n.target.value,(a=t.bind(i),r=(r=e.interval)||20,s=s||!0,function(){var e=this,t=arguments,n=s&&!o,i=function(){o=null,s||a.apply(e,t)};clearTimeout(o),o=setTimeout(i,r),n&&a.apply(e,t)})())}))}e.collectInputs();var a=0;if(e.text&&e.text.forEach((function(e){e.id||(e.id=(e.name?e.name:"tx")+"-"+a),a++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.number&&e.number.forEach((function(e){e.id||(e.id=(e.name?e.name:"num")+"-"+a),a++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.radio&&e.radio.forEach((function(i){i.id||(i.id=(i.name?i.name:"rb")+"-"+a),a++,i.id&&!i.dataset.freeze&&(e.enabledUncheckRadio?document.body.addEventListener("click",(function(e){if(e.target.id==i.id){var n=e.target.dataset.state||"";Boolean(n.toString())?(e.target.checked=!1,e.target.dataset.state=""):e.target.dataset.state=e.target.checked,t.call(i)}})):n("change",i))})),e.checkbox&&e.checkbox.forEach((function(e){e.id||(e.id=(e.name?e.name:"cb")+"-"+a),a++,e.id&&!e.dataset.freeze&&n("change",e)})),e.textarea&&e.textarea.forEach((function(e){e.id||(e.id=(e.name?e.name:"ta")+"-"+a),a++,e.id&&!e.dataset.freeze&&(n("keyup",e),n("change",e))})),e.setRadioGroup)try{e.radio&&e.radio.forEach((function(e){e.name=e.id?e.id.match(/(.*?)(\d+)/)[0].replace("-0-",""):e.name}))}catch(e){}},this.restore=function(e){var t=this;setTimeout((function(){t.getLocalData().then((function(){t.data.length&&t.data.forEach((function(e){var a=e.id;if(a)if(isNaN(a)){var r=n("#"+a);if(r)switch(e.type){case"text":case"number":case"textarea":r.value=e.value||"";break;case"radio":case"checkbox":r.checked=e.value;break;case"div":if(e.value){var s=r.cloneNode(!0);s.dataset.category=e.value;var o=t.getQContainer(r);if(o){var c=o.getElementsByClassName(e.value)[0];c&&(c.appendChild(s),r.parentNode.removeChild(r))}}break;default:i("warn",["invalid input type:",e.type])}else i("error",["unable to find input by id:",a])}else i("error",["invalid input selector:",a]);else i("error",["invalid input selector:",a])})),t.renderInlineBar(),"function"==typeof e?e():(window.unsaved=!1,t.listener.emit("persister.restored",{target:t}))}))}),0)},this.getQContainer=function(e){for(;!e.classList.contains("ques");)e=e.parentNode;return e},this.renderSaveTab=function(e){var t=this;if(e)e.addEventListener("click",(function(e){e.preventDefault(),t.isSaveGlobal=!0,t.push()}));else if(!n("#save-changes")){var i=n("#tabMenu");if(i){var a=i.querySelectorAll("a:not(.chapterBtn)");if(a.length){var r=(a=a[0]).parentNode,s=a.cloneNode(!0);s.id="save-changes",s.querySelector(".icon").className="icon ion-"+(t.saveGlobal.icon||"checkmark-circled"),s.querySelector(".tab-title").innerText=t.saveGlobal.label||t.messages.save,r.insertAdjacentHTML("beforeend",s.outerHTML)}n("#save-changes").addEventListener("click",(function(e){e.preventDefault(),t.isSaveGlobal=!0,t.push()}))}}},this.init=function(){var e=this;function t(){e.delegateEvents&&e.processInputs(),e.enabled&&(e.renderInlineBar(),e.renderFloatingBar()),window.addEventListener("beforeunload",(function(t){"undefined"!=typeof kotobee&&(-1!=!location.hostname.indexOf("localhost")&&-1!=!location.hostname.indexOf("127.0.0.1")||"undefined"!=typeof config&&!config.kotobee.public||e.testMode)&&window.unsaved&&(e.setNotify(),t.preventDefault(),t.returnValue="",delete t.returnValue)}))}kInteractive.isEditorMode()||("cloud"==e.storage&&kInteractive.isKotobeeUser()?kotobee.getDataPerms((function(n){n&&n.maxDataSize&&(e.maxDataSize=n.maxDataSize,i("warn",["data size limit:",e.maxDataSize]),t())})):t()),window.unsaved=!1,e.listener.emit("persister.ready",{target:e})},this.listener=new function(){this.listeners={},this.on=function(e,t){return this.addListener(e,t)},this.once=function(e,t){this.listeners[e]=this.listeners[e]||[];var n=function(){t(),this.off(e,n)};return this.listeners[e].push(n),this},this.off=function(e,t){return this.removeListener(e,t)},this.die=function(e){return this.removeAllListeners(e)},this.addListener=function(e,t){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t),this},this.removeListener=function(e,t){var n=this.listeners[e]||[];return this.listeners[e]=n.filter((function(e){return e!==t})),this},this.removeAllListeners=function(e){return delete this.listeners[e],this},this.emit=function(){if(arguments.length<1)return!1;var e=arguments[0],t=this.listeners[e];if(!t)return!1;var n=arguments.length>1?Array.prototype.slice.call(arguments).slice(1):[];return t.forEach((function(e){e.apply(this,n)})),!0},this.listListeners=function(e){return this.listeners[e]||[]}};var t=this;function n(){if(arguments.length<1)return null;var e=arguments[0],t=null;if("string"==typeof e){var i=!1,a=document;if(arguments.length>1)for(var r,s=Array.prototype.slice.call(arguments).slice(1),o=0;o<s.length;o++)"boolean"==typeof(r=s[o])?i=r:"object"==_typeof(r)&&(a=r);if(0==(t=Array.prototype.slice.call(a.querySelectorAll(e))).length)return null;t=i||1!=t.length?t:t[0]}else t=e;return Array.isArray(t)||(t.find=function(e,i){return n(e,t,i)},t.parents=function e(n){var i=null,a=-1!=n.indexOf(".")?n.split(".")[1]:"";t.parentNode.nodeName.toLowerCase()==n.toLowerCase()||""!=a&&t.parentNode.classList.contains(a)||t.parentNode.id==n.replace("#","")?i=t.parentNode:"body"==t.parentNode.nodeName.toLowerCase()||i||(t=t.parentNode,i=e(n));return i},t.closest=function(e){return function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null}(t,e)},t.ascendants=function(e){return function(e){Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});for(var t=[];e&&e!==document;e=e.parentNode)t.push(e);return t}(t)}),t}function i(e,t){"dev"==(window.debug||-1!=location.hostname.indexOf(".local")||-1!=location.hostname.indexOf("kotobee.com")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("localhost")||-1!=location.hostname.indexOf("192.168.")?"dev":"production")&&console[e].apply(null,t)}(function(e){return Object.getOwnPropertyNames(e).filter((function(t){return"function"==typeof e[t]}))})(this.listener).forEach((function(e){t[e]||(t[e]=t.listener[e].bind(t.listener))})),e&&this.setOptions(e),this.storageAPI=-1!=["session","cloud"].indexOf(this.storage)?sessionStorage:localStorage,kInteractive.setStorage(this.storageAPI)}kInteractive.helpers.persister={instances:{},addInstance:function(e,t){kInteractive.helpers.persister.instances[e]=new kPersister(t)}},kInteractive.audio={preRender:function(e,t){},postRender:function(e,t,n){var i=e.createDocumentFragment(),a=kInteractive.readData(t);t.setAttribute("id","ki-audio-"+n),t.innerHTML="";var r=document.createElement("div");r.setAttribute("id","ki-audio-"+n+"-container"),r.className="container";var s=document.createElement("a");s.className="playBtn ki-btn",s.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&s.addEventListener("click",kInteractive.actionEvent);var o=document.createElement("div");if(a.style&&kInteractive.c.addClass(o,a.style),i.appendChild(s),i.appendChild(r),o.appendChild(i),t.appendChild(o),a.autoplay)kInteractive.action(t)},action:function(e){kInteractive.stopCurrentMedia();var t=kInteractive.readData(e);if(t){t.audioType||(t.audioType=t.type);e.getAttribute("id");e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide";var n=t.src;if("file"==t.audioType&&(n="undefined"==typeof isKotobee?t.audio:t.relToRoot?ph.join(bookPath,t.audio):ph.join(kInteractive.absoluteURL,t.audio)),kInteractive.scorm){var i={};i.id=kInteractive.getScormId(e.getAttribute("id"),n),i.description="Played audio: "+n,i.type="other",i.learnerResponses="Played",i.objective=t.options?t.options.objective:null,i.timestamp=new Date,kInteractive.scorm.setInteractions([i])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:n,elem:e,data:t});var a=document.createElement("audio");a.setAttribute("controls","true"),a.setAttribute("autoplay","true"),a.setAttribute("data-tap-disabled","false");var r=document.createElement("source");r.src=kInteractive.cleanURL(n),a.appendChild(r),a.appendChild(document.createTextNode("Your browser does not support the audio element")),a.className="ki-noHighlight",t.options&&t.options.hideDownloadBtn&&(a.className+=" hideDownloadBtn",a.setAttribute("controlsList","nodownload")),a.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+n})},e.getElementsByClassName("container")[0].appendChild(a),a.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}}};var kInteractiveCommon=(_kInteractiveCommon={checkResponsiveFloat:function(e,t){if(e&&e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}},openLink:function(e){var t={cb:function(t){var n=document.createElement("iframe");n.src=e,t.appendChild(n)},closed:function(){}};kInteractive.openFrame(t)},openFrame:function(e){var t=document.getElementById("kInteractiveFrame"),n=document.getElementById("kiDarkOverlay"),i="";if(e.dict||(e.dict={}),e.width&&(i+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(i+="height:"+e.height+"px;max-height:"+e.height+"px;"),t||((n=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(n),n.style.display="none",n.style.position="fixed",n.addEventListener("click",kInteractive.closeFrame),(t=document.createElement("div")).id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var a=document.createElement("a"),r="closeBtn";e.pos&&(r+=" "+e.pos),a.className=r;var s="Close";try{"undefined"!=typeof translit&&(s=translit.get("close"))}catch(e){}e.dict&&e.dict.close&&(s=e.dict.close),"side"!=e.pos&&(a.innerHTML=s),a.addEventListener("click",kInteractive.closeFrame),t.appendChild(a)}var o=e.class?e.class:"";(e.width||e.height)&&(o+=" fixed"),e.aspectRatio&&(o+=" aspectRatio"),t.style.display="block",t.className=o,document.body.appendChild(t),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e;try{if("undefined"!=typeof isKotobee&&!isNative){var c=window.location.hash.split("#");c.length>1&&(window.location.hash+=(-1==c[1].indexOf("?")?"?":"&")+"popup",window.addEventListener("hashchange",this.backBtnPressed))}}catch(e){}function l(){n.style.display="block",n.className="show";var a=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;a-=20,r-=20;var s=1;if(e.width&&e.height){var c=r/e.width,l=a/e.height;(s=c<l?c:l)>1&&(s=1)}var d="display:block;";d+=i;var u=!1;try{"undefined"!=typeof isKotobee&&(u=stg.data.settings.rtl)}catch(e){}var p=e.width||e.height?(u?"50%":"-50%")+",-50%":"0%,0%";d+="-webkit-transform:translate("+p+") scale("+s+");-moz-transform:translate("+p+") scale("+s+");transform:translate("+p+") scale("+s+");",d+="position:fixed;","undefined"==typeof isKotobee&&"-50%,-50%"==p&&(d+="top:"+Math.round(window.innerHeight/2)+"px;",d+="left:"+Math.round(window.innerWidth/2)+"px;"),-1!=o.indexOf("aspectRatio")&&window.innerWidth/window.innerHeight>16/9&&(d+="padding-bottom: "+95*window.innerHeight/Math.round(window.innerWidth)+"%"),t.style.cssText=d,t.className=o+" ready";var v=t.getElementsByClassName("closeBtn");if(v.length){var m=v[0],h=1/s,f="-50%";kInteractive.hasClass(m,"side")&&(f="0%"),m.style.cssText="-webkit-transform: translate("+f+",0%) scale("+h+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+f+",0%) scale("+h+");-moz-transform-origin: 50% 50%;transform: translate("+f+",0%) scale("+h+");transform-origin: 50% 50%;"}}kInteractive.openFrame.resized=l,window.addEventListener("resize",l),setTimeout((function(){l(),e.cb&&e.cb(t)}),100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t&&t.parentNode.removeChild(t),n&&n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1,window.removeEventListener("resize",kInteractive.alert.resized),kInteractive.alert&&(kInteractive.alert.resized=null)},backBtnPressed:function(e){e.oldURL&&e.oldURL.match(/[?&]popup/g)&&(window.removeEventListener("hashchange",kInteractive.backBtnPressed),kInteractive.closeFrame())},getParentInteractiveElem:function(e,t){for(t||(t="kInteractive");e&&e.parentNode;){if(t&&e.classList.contains(t))return e;e=e.parentNode}return e&&e.parentNode&&e.classList.contains(t)?e:null},closeFrame:function(){document.getElementById("kFullscreenGallery")&&kInteractive.gallery.exitFullscreen();var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,i="";n.width&&(i+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(i+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=i,t.className="",setTimeout((function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null}),300),window.removeEventListener("hashchange",kInteractive.closeFrame),window.location.hash=window.location.hash.replace(/[?&]popup/g,"")},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";if(n=document.getElementById(e)){var t=n.parentNode;n.parentNode.removeChild(n),(i=document.createElement("div")).setAttribute("id",e),i.className="container",(a=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),t.appendChild(i)}}var n;if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id")){if(e+="-container",n=document.getElementById(e)){var i,a;t=n.parentNode;n.parentNode.removeChild(n),(i=document.createElement("div")).setAttribute("id",e),i.className="container playerContainer",(a=kInteractive.currentAudio.getElementsByClassName("playBtn")[0])&&(a.className="playBtn ki-btn"),kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),t.appendChild(i)}}else try{var r=kInteractive.currentAudio.getElementsByTagName("audio");r.length&&(r[0].pause(),r[0].src=""),kInteractive.currentAudio.pause&&(kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="");for(var s=document.getElementsByClassName("kiAudioLoader"),o=s.length;o--;)s[o].parentNode.removeChild(s[o])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),i=0;i<n.length;i++)if(n[i]&&n[i].trim()==t)return!0},appendAfterDelay:function(e,t){setTimeout((function(){e.appendChild(t)}),30)},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,i=n.cloneNode(!1);
/*@cc_on // Pure innerHTML is slightly faster in IE
     oldEl.innerHTML = html;
     return oldEl;
     @*/return i.innerHTML=t,n.parentNode.replaceChild(i,n),i},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var i,a=document.implementation.createHTMLDocument(""),r=a.documentElement;return r.innerHTML=e,i=r.firstElementChild,1===r.childElementCount&&"html"===i.localName.toLowerCase()&&a.replaceChild(i,r),a}return n.apply(this,arguments)}}(DOMParser)},compareVersions:function(e,t){if(e==t)return 0;if(null==e)return 1;if(null==t)return-1;var n=e.split("."),i=t.split(".");return i.length?n.length?Number(n[0])>Number(i[0])?1:Number(i[0])>Number(n[0])?-1:(n.shift(1),i.shift(1),kInteractive.compareVersions(n.join("."),i.join("."))):-1:1},readData:function(e){var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),this.readRawData(t)},readRawData:function(e){try{var t=1;if(!e)return;return JSON.parse(decodeURI(kInteractive.XORCipher(t).decode("kotobee%%author",e)))}catch(n){try{return JSON.parse(kInteractive.XORCipher(t).decode("kotobee%%author",e))}catch(e){}}},writeData:function(e,t,n){n||(n=1);var i=encodeURI(JSON.stringify(t)),a=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(a,kInteractive.XORCipher(n).encode("kotobee%%author",i))},XORCipher:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n={encode:function(e,n){return n=function(e,t){return a(t,(function(t,n){return t.charCodeAt(0)^i(e,n)}))}(e,n),function(e){var n,i,a,r,s,o=0,c="";if(!e)return e;do{n=(r=e[o++]<<16|e[o++]<<8|e[o++])>>12&63,i=r>>6&63,a=63&r,c+=t.charAt(r>>18&63)+t.charAt(n)+t.charAt(i)+t.charAt(a)}while(o<e.length);return s=e.length%3,(s?c.slice(0,s-3):c)+"===".slice(s||3)}(n)},decode:function(e,n){return function(e,t){return a(t,(function(t,n){return String.fromCharCode(t^i(e,n))})).join("")}(e,n=function(e){var n,i,a,r,s,o,c=0,l=[];if(!e)return e;e+="";do{n=(o=t.indexOf(e.charAt(c++))<<18|t.indexOf(e.charAt(c++))<<12|(r=t.indexOf(e.charAt(c++)))<<6|(s=t.indexOf(e.charAt(c++))))>>16&255,i=o>>8&255,a=255&o,l.push(n),64!==r&&(l.push(i),64!==s&&l.push(a))}while(c<e.length);return l}(n))}};return n;function i(e,t){return e.charCodeAt(Math.floor(t%e.length))}function a(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}},getScormId:function(e,t){return e+(t=t?"-"+t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80):"")},confirm:function(e){kInteractive.alert(e)},alert:function(e){if(e){this.closeAlert();var t=document.createElement("div");if(t.setAttribute("id","kiSystemAlertBox"),e.raw&&(t.className="raw"),t.style.position="fixed","undefined"==typeof isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px"),e.rtl&&t.setAttribute("direction","rtl"),e.fullHeight&&(t.className+=" fullHeight"),e.class&&(t.className+=" "+e.class),e.raw)t.innerHTML=e.content.replace("&nbsp;","&#160;");else{var n=document.createElement("div");n.innerHTML=e.content.replace("&nbsp;","&#160;"),n.className="content",t.appendChild(n)}if(e.title){var i=document.createElement("div");i.innerHTML=e.title.replace("&nbsp;","&#160;"),i.className="header",t.insertBefore(i,t.firstChild)}kInteractive.alertIsOpen=!0;var a=document.createElement("a");if(!e.raw){var r=document.createElement("div");r.className="footer";var s="OK";try{"undefined"!=typeof translit&&(s=translit.get("ok"))}catch(e){}if(e.okBtn&&(s=e.okBtn),a.innerHTML=s.replace("&nbsp;","&#160;"),a.className="okBtn",a.addEventListener("click",kInteractive.closeAlert),e.cb&&a.addEventListener("click",e.cb),r.appendChild(a),e.noBtn){var o=document.createElement("a");o.innerHTML=e.noBtn,o.className="cancelBtn",o.addEventListener("click",kInteractive.closeAlert),r.appendChild(o)}t.appendChild(r)}var c=document.createElement("div");e.noBackdrop||(c.setAttribute("id","kiSystemAlertBackdrop"),c.addEventListener("click",kInteractive.closeAlert),c.style.position="fixed",document.body.appendChild(c)),document.body.appendChild(t),a.focus(),kInteractive.alert.resized=l,window.addEventListener("resize",l),setTimeout((function(){kInteractive.c.addClass(t,"show"),kInteractive.c.addClass(c,"show")}),50)}function l(){"undefined"==typeof isKotobee&&(t.style.top=Math.round(window.innerHeight/2)+"px",t.style.left=Math.round(window.innerWidth/2)+"px")}},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)-1==n.indexOf(t[a])&&(i=!1,n+=(""==n?"":" ")+t[a]);if(i)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},toggleClass:function(e,t){this.strHasClass(e.className,t)?this.removeClass(e,t):this.addClass(e,t)},hasClass:function(e,t){var n=e.className;return e instanceof SVGElement&&(n=n.baseVal),this.strHasClass(n,t)},strHasClass:function(e,t){e||(e="");for(var n=e.trim().split(" "),i=0;i<n.length;i++)if(n[i]==t)return!0;return!1},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)n.indexOf(t[a])>=0&&(i=!1,n=n.replace(t[a],""));if(i)return}else{if(-1==n.indexOf(t))return;n=(n=n.replace(t,"")).replace(/ {2,}?/g," ")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);if(-1==t[t.length-1].indexOf("."))return e;t.splice(t.length-1,1);var n=t.join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(n="/"+n),n},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/kotobee:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),t[0].match(/chrome-extension:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t},normalize:function(e){var t=kInteractive.c.normalizedArray(e).join("/");return arguments.length&&"/"==arguments[0].substr(0,1)&&(t="file:///"+t),t},join:function(){for(var e=new Array,t=0;t<arguments.length;t++){var n=kInteractive.c.normalizedArray(arguments[t]);t<arguments.length-1&&!kInteractive.isAbsolutePath(n[n.length-1])&&n[n.length-1].indexOf(".")>=0&&n.splice(n.length-1,1),e=e.concat(n)}var i=kInteractive.c.normalize(e.join("/"));return"/"==arguments[0].substr(0,1)&&(i=desktop?"file:////"+i:"/"+i),i}},shuffleArray:function(e){return e.sort((function(){return Math.random()-.5})),e},allowDrop:function(e){e.preventDefault();var t=e.target.closest(".ki-dd-answers, .dCategory, .ki-ord-answers");if(t){var n=e.view&&e.view.dragged;if(n){var i=n.getAttribute("data-qid"),a=t.getAttribute("data-qid")||t.closest(".ques")&&t.closest(".ques").id;if(i&&a&&i!==a)try{e.dataTransfer.dropEffect="none"}catch(e){}}}},drag:function(e){e.stopPropagation(),e.dataTransfer&&e.dataTransfer.setData("text",e.target.id),dragged=e.target},drop:function(e){e.preventDefault(),e.target.hasAttribute("ondragover")&&e.target.appendChild(e.view.dragged)},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))},getChildIndex:function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t},isAbsolutePath:function(e){if(e)return 0==e.trim().indexOf("http://")||(0==e.trim().indexOf("https://")||(0==e.trim().indexOf("//")||(0==e.trim().indexOf("data:")||(!!/.\:[\\\/].*/g.test(e.trim())||void 0))))},isMobile:function(e){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!0;try{if(window.location.href.indexOf("?preview")>0){var t=window.location.href.split("?");t=t[1].split("&");for(var n={},i=0;i<t.length;i++){var a=t[i].split("=");n[a[0]]=a[1]}if(n.mobile)return!0}}catch(e){}}},_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"getChildIndex",(function(e){for(var t=0;null!=(e=e.previousSibling);)t++;return t})),"closeFullscreenVideo",(function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)})),"getWidgetHome",(function(e,t){return t||(t={}),e.path?"undefined"==typeof isKotobee?e.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,e.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/"})),"isKotobeeUser",(function(){return"undefined"!=typeof kotobee&&kotobee.user&&kotobee.user.loggedIn})),"getWidgetUrl",(function(e,t){var n=kInteractive.getWidgetHome(e,t)+"/"+e.name+"/"+e.src;if("undefined"!=typeof isKotobee){var i=angular.element(document.body).scope().data.user;i&&i.email&&i.signatures&&i.signatures.bookwidgets&&e.id&&0==e.id.indexOf("com.kidimedia")&&(n+="?oauth_signature="+i.signatures.bookwidgets.signature,n+="&oauth_nonce="+i.signatures.bookwidgets.nonce,n+="&oauth_timestamp="+i.signatures.bookwidgets.timestamp,n+="&oauth_consumer_key="+i.signatures.bookwidgets.key,n+="&lti_version=LTI-1p0",n+="&oauth_signature_method=HMAC-SHA1",n+="&oauth_version=1.0",n+="&tool_consumer_info_product_family_code=kotobee",n+="&lis_person_contact_email_primary="+i.email,n+="&lis_person_name_full="+(i.name?i.name:""),n+="&user_id="+i.id,n+="&lti_message_type=basic-lti-launch-request",angular.element(document.body).scope().refreshSignatures&&angular.element(document.body).scope().refreshSignatures())}return n=kInteractive.cleanURL(n)})),"clearAudioVideo",(function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),i=n.length;i--;)try{if(n[i].hasAttribute("data-dontclose"))continue;n[i].pause()}catch(e){}var a=t.getElementsByTagName("video");for(i=a.length;i--;)a[i].pause(),a[i].children.length||(a[i].src="")})),"cleanURL",(function(e){try{isNative&&mobile&&(e=(e=window.Ionic.WebView.convertFileSrc(e)).replace(/([^:])\/\//g,"$1/"))}catch(e){}return e})),"listenForSwiping",(function(e){e.addEventListener("touchstart",(function(e){t=e.touches[0].clientX,n=e.touches[0].clientY}),!1),e.addEventListener("touchmove",(function(i){if(null===t)return;if(null===n)return;var a=i.touches[0].clientX,r=i.touches[0].clientY,s=t-a,o=n-r;s>5?(e.dispatchEvent(new Event("swipeleft")),c()):s<-5?(e.dispatchEvent(new Event("swiperight")),c()):o>5?(e.dispatchEvent(new Event("swipeup")),c()):o<-5&&(e.dispatchEvent(new Event("swipedown")),c());function c(){t=null,n=null}i.preventDefault()}),!1);var t=null,n=null})),"unique",(function(e){return e.filter((function(e,t,n){return n.indexOf(e)===t}))})),"getFile",(function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200===n.status&&t(n.responseText)},n.send()})),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"getBookID",(function(){var e=document.head.querySelector('meta[name="kotobee-book"]');return"undefined"!=typeof isKotobee&&kotobee.book?kotobee.book.meta.dc.identifier.replace("urn:uuid:","")+(kotobee.user&&kotobee.user.email?kotobee.user.email:""):e?e.content.replace("urn:uuid:",""):""})),"getChapterID",(function(){var e;if("undefined"!=typeof isKotobee)e=kotobee.currentChapter?kotobee.currentChapter.url:"/ch1.xhtml";else{var t=document.head.querySelector('meta[name="kotobee-chapter"]');e=t?t.content:""}return e.substring(e.lastIndexOf("/")+1).replace(".xhtml","")})),"setStorage",(function(e){kInteractive.storage=e||sessionStorage})),"getLocalData",(function(e,t){var n=e.label||e.category;if(e)if(t)if(n){var i=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";i=(i=JSON.parse(i)).filter((function(t){return e.label?e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label:e.subcategory?t.category==e.category&&t.subcategory==e.subcategory:t.category==e.category})),t(i)}else t({error:"invalid label or category!"});else;else;})),"getLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var i=[];e.forEach((function(e){(e.label||e.category)&&i.push({results:n.filter((function(t){return e.label?e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label:e.subcategory?t.category==e.category&&t.subcategory==e.subcategory:t.category==e.category}))})})),t(i.length?i:n)}else;else t([{error:"invalid array!"}])})),"setLocalData",(function(e,t){if(e)if(t)if(e.label)if(e.data){var n={label:e.label,data:e.data,date:(new Date).toUTCString()};e.category&&(n.category=e.category),e.subcategory&&(n.subcategory=e.subcategory);var i=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";if(i=JSON.parse(i),e.overwrite){var a=i.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=a?i.splice(a,1,n):i.push(n)}else i.push(n);kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(i)),t({success:"added"})}else t({error:"invalid data!"});else t({error:"invalid label!"});else;else;})),"setLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var i={};e.forEach((function(e){if(e.label){if(!i.hasOwnProperty("error")){var t={label:e.label,data:e.data,date:(new Date).toUTCString()};if(e.category&&(t.category=e.category),e.subcategory&&(t.subcategory=e.subcategory),e.overwrite){var a=n.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=a?n.splice(a,1,t):n.push(t)}else n.push(t)}}else i.error="invalid label!"})),i.hasOwnProperty("error")||(i.success="added"),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t(i)}else;else t([{error:"invalid array!"}])})),"deleteLocalData",(function(e,t){if(e)if(t)if(e.label){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]",i=(n=JSON.parse(n)).findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=i&&n.splice(i,1),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t({success:!0})}else t({error:"invalid label!"});else;else;})),"deleteLocalDataArray",(function(e,t){if(Array.isArray(e))if(t){var n=kInteractive.storage.getItem("ebook-"+kInteractive.getBookID())||"[]";n=JSON.parse(n);var i={};e.forEach((function(e){if(e.label){if(!i.hasOwnProperty("error")){var t=n.findIndex((function(t){return e.category?e.subcategory?t.label==e.label&&t.category==e.category&&t.subcategory==e.subcategory:t.label==e.label&&t.category==e.category:t.label==e.label}));-1!=t&&n.splice(t,1)}}else i.error="invalid label!"})),i.hasOwnProperty("error")||(i.success=!0),kInteractive.storage.setItem("ebook-"+kInteractive.getBookID(),JSON.stringify(n)),t(i)}else;else t([{error:"invalid array!"}])})),"clearLocalData",(function(){kInteractive.storage?kInteractive.storage.removeItem("ebook-"+kInteractive.getBookID()):kInteractive.error("unable to find storage!")})),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_kInteractiveCommon,"isEditorMode",(function(){return"undefined"!=typeof editorMode&&editorMode})),"isPreview",(function(){return/\/Kotobee\s?Author\//.test(location.pathname)})),"isSDK",(function(){if("undefined"!=typeof isKotobee)return!isRelease;var e=-1!=location.host.indexOf("localhost")&&-1!=["http:","https:"].indexOf(location.protocol);return e||(e=-1!=location.href.indexOf("reader/www/epub/EPUB")),e})),"getBoundingBox",(function(e){if(3==e.nodeType){var t=document.createRange();t.selectNode(e);var n=t.getBoundingClientRect();return t.detach(),n}return e.getBoundingClientRect()})),"simpleHash",(function(e){var t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n})),"phpDateToJS",(function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])})),"getClock",(function(e){if(kInteractive.clocks||(kInteractive.clocks=[],setInterval((function(){for(var e=0;e<kInteractive.clocks.length;e++){var t=kInteractive.clocks[e];t.paused||(t.time++,t.cb&&t.cb(t.time))}}),1e3)),kInteractive.clocks[e])return kInteractive.clocks[e];var t={id:e,time:0,pause:function(){this.paused=!0},resume:function(){this.paused=!1},destroy:function(){for(var e=0;e<kInteractive.clocks.length;e++)if(kInteractive.clocks[e]==this)return kInteractive.clocks.splice(e,1)}};return kInteractive.clocks.push(t),t})),"observe",(function(e,t,n){kInteractive.observers||(kInteractive.observers=[]);var i=new IntersectionObserver((function(e){for(var i=0;i<e.length;i++)0==e[i].intersectionRatio?(n&&n(),e[i].hidden&&e[i].hidden()):(t&&t(),e[i].shown&&e[i].shown())}),{threshold:[0,1],rootMargin:"0px"});kInteractive.observers.push(i),i.observe(e)})),"getTimezone",(function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return"GMT"}})));for(var item in kInteractiveCommon)kInteractive[item]=kInteractiveCommon[item];kInteractive.setStorage(),kInteractive.container={preRender:function(e,t){var n=kInteractive.readData(e);if(n&&n.path){var i=e.getAttribute("style"),a=kInteractive.cleanURL(n.path);e.setAttribute("style",i+' background-image:url("'+a+'");')}},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e){},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.equation={preRender:function(e,t){if(!kInteractive.isEditorMode()&&"undefined"==typeof MathJax){MathJax={loader:{load:["input/asciimath","input/mml","input/tex","output/chtml","ui/menu"]}};var n=document.createElement("script"),i="";i="undefined"==typeof isKotobee?"../../js/lib/mathjax/startup.js":kInteractive.c.join(bookPath,"EPUB/js/lib/mathjax/startup.js"),n.src=kInteractive.cleanURL(i),n.setAttribute("type","text/javascript"),document.head.appendChild(n)}},postRender:function postRender(root,item,index){var frag=root.createDocumentFragment(),eData=kInteractive.readData(item);if(eData){item.setAttribute("id","ki-equation-"+index),item.innerHTML="";var content=eData.content;if(!eData.img||"image"!=eData.rendermode&&supportsEs6())"mathml"==eData.type?content="<math>"+content+"</math>":"asciimath"==eData.type?content="`"+content+"`":"tex"==eData.type&&(content="\\("+content+"\\)");else{var img=document.createElement("img"),path="undefined"==typeof isKotobee?eData.img:ph.join(kInteractive.absoluteURL,eData.img);path=kInteractive.cleanURL(path),img.className="equationImg",img.src=path,eData.imgHeight?img.style.maxHeight=eData.imgHeight+"px":eData.imgWidth&&(img.style.maxWidth=eData.maxWidth+"px"),content=img.outerHTML}var tagName="inline"==eData.placement?"span":"div",container=document.createElement(tagName);container.setAttribute("id","ki-equation-"+index+"-container"),container.className="parsed container";try{container.innerHTML=content}catch(e){container.textContent=content}var styleContainer=document.createElement(tagName);eData.style&&kInteractive.c.addClass(styleContainer,eData.style),frag.appendChild(container),styleContainer.appendChild(frag),item.appendChild(styleContainer),kInteractive.isEditorMode()||MathJax&&MathJax.typeset&&MathJax.typeset()}function supportsEs6(){try{return eval('"use strict"; class foo {}'),!0}catch(e){}}},action:function(e){kInteractive.readData(e)},resize:function(e){kInteractive.readData(e)}},kInteractive.gallery={preRender:function(e,t){var n=t.createDocumentFragment(),i=kInteractive.readData(e);if(i){e.innerHTML="";var a=e.getAttribute("data-index");a||(a=0),i.rtl&&kInteractive.c.addClass(e,"dirRtl");var r=document.createElement("div");r.className="imgMask";var s=document.createElement("div");s.className="images "+i.scale;var o=i.rtl?"right":"left";s.style[o]="0",r.appendChild(s);for(var c=0;c<i.imgs.length;c++){var l,d=document.createElement("div");d.className="imgContainer ki-btn",l="url"==i.imgs[c].type?i.imgs[c].url:"undefined"==typeof isKotobee?i.imgs[c].path:ph.join(kInteractive.absoluteURL,i.imgs[c].path),l=kInteractive.cleanURL(l),d.setAttribute("style","background-color:"+i.bgColor+";background-image:url('"+l+"')"),i.imgs[c].caption&&d.setAttribute("data-caption",i.imgs[c].caption),"undefined"!=typeof isKotobee||kInteractive.c.hasClass(e,"fullscreen")||d.addEventListener("click",kInteractive.actionEvent),s.appendChild(d)}var u=document.createElement("div");u.className="navBtns";var p=document.createElement("a");p.className="next btn ki-btn",u.appendChild(p);var v=document.createElement("a");if(v.className="prev btn ki-btn",u.appendChild(v),n.appendChild(u),i.zoomBtns){var m=document.createElement("div");m.className="zoomBtns";var h=document.createElement("a");h.className="zoomIn btn ki-btn",h.textContent="+",h.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="square" stroke-linejoin="square"><line x1="10" y1="4" x2="10" y2="16"/><line x1="4" y1="10" x2="16" y2="10"/></svg>',m.appendChild(h);var f=document.createElement("a");f.className="zoomFit btn ki-btn",f.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="16" height="16" stroke="currentColor" fill="none"/><line x1="5" y1="5" x2="2" y2="2"/><line x1="5" y1="2" x2="2" y2="5"/><line x1="15" y1="5" x2="18" y2="2"/><line x1="15" y1="2" x2="18" y2="5"/><line x1="5" y1="15" x2="2" y2="18"/><line x1="5" y1="18" x2="2" y2="15"/><line x1="15" y1="15" x2="18" y2="18"/><line x1="15" y1="18" x2="18" y2="15"/></svg>',m.appendChild(f);var g=document.createElement("a");g.className="zoomOut btn ki-btn",g.innerHTML='<svg width="15" height="15" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="square" stroke-linejoin="square"><line x1="6" y1="10" x2="14" y2="10"/></svg>',m.appendChild(g),n.appendChild(m)}("undefined"==typeof isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&(p.addEventListener("click",kInteractive.actionEvent),v.addEventListener("click",kInteractive.actionEvent),i.zoomBtns&&(h.addEventListener("click",kInteractive.actionEvent),f.addEventListener("click",kInteractive.actionEvent),g.addEventListener("click",kInteractive.actionEvent))),n.appendChild(r);var k=document.createElement("div");k.className="kFooter",i.footerShadow&&(k.className+=" shadow"),n.appendChild(k);var y=document.createElement("div");y.className="imgCaption";var b=document.createElement("div");if(b.className="inner",b.style.display="none",i.imgs[0]&&i.imgs[0].caption&&(b.innerHTML=i.imgs[0].caption,b.style.display=null),y.appendChild(b),k.appendChild(y),i.thumbnails){var I=document.createElement("div");I.className="kThumbs",i.thumbShowOnHover&&(I.className+=" showOnHover"),"small"==i.thumbSize?kInteractive.c.addClass(I,"small"):"large"==i.thumbSize?kInteractive.c.addClass(I,"large"):kInteractive.c.addClass(I,"medium"),k.appendChild(I)}if(kInteractive.c.hasClass(e,"fullscreen")){var C=document.createElement("div");C.className="fullscreenControls",C.innerHTML="<a class='closeBtn ki-btn'></a>",e.appendChild(C),C.children[0].addEventListener("click",kInteractive.actionEvent),document.addEventListener("keydown",kInteractive.gallery.detectKey)}var w=document.createElement("div");i.style&&kInteractive.c.addClass(w,i.style),w.appendChild(n),e.appendChild(w),kInteractive.gallery.dimBtns(e),kInteractive.gallery.resize(e),this.showImage(e,{index:a,dontGoFullscreen:!0}),setTimeout((function(){kInteractive.gallery.showImage(e,{index:a,dontGoFullscreen:!0})}),80)}},postRender:function(e,t,n){kInteractive.gallery.resize(t);var i=this.getState(t);this.dimBtns(t),this.showImage(t,{index:i.selectedIndex,dontGoFullscreen:!0})},action:function(e,t,n){kInteractive.readData(e),e.getElementsByClassName("images")[0].getElementsByClassName("selected")[0];if(kInteractive.hasClass(t,"btn")){if(kInteractive.hasClass(t,"disable"))return n.stopPropagation();kInteractive.hasClass(t,"next")?kInteractive.gallery.showImage(e,{dir:"next"}):kInteractive.hasClass(t,"prev")?kInteractive.gallery.showImage(e,{dir:"prev"}):kInteractive.hasClass(t,"zoomIn")?kInteractive.gallery.zoomImage(e,"in"):kInteractive.hasClass(t,"zoomOut")?kInteractive.gallery.zoomImage(e,"out"):kInteractive.hasClass(t,"zoomFit")&&kInteractive.gallery.zoomImage(e,"fit")}else if(kInteractive.hasClass(t,"closeBtn"))kInteractive.gallery.exitFullscreen();else if(kInteractive.hasClass(t,"imgContainer")){if(kInteractive.readData(e).fullscreenMode)return kInteractive.gallery.goToFullscreen(e)}else if(kInteractive.hasClass(t,"kMapItem")){var i=kInteractive.getChildIndex(t);kInteractive.gallery.goToThumb(e,{windowIndex:i,highlightThumb:!1})}else if(kInteractive.hasClass(t,"kThumb")){i=t.getAttribute("data-index");kInteractive.gallery.showImage(e,{index:t.getAttribute("data-index")})}else if(kInteractive.hasClass(t,"thumbNavBtn")){kInteractive.hasClass(t,"next")?kInteractive.gallery.goToThumb(e,{dir:"nextWindow",highlightThumb:!1}):kInteractive.hasClass(t,"prev")&&kInteractive.gallery.goToThumb(e,{dir:"prevWindow",highlightThumb:!1})}kInteractive.gallery.dimBtns(e)},goToThumb:function(e,t){var n=kInteractive.readData(e);t||(t={});var i,a,r=this.getState(e),s=r.thumbWindows,o=r.activeWindow,c=r.currentIndex,l=r.selectedIndex,d=r.currentThumb,u=t.index;if(null==u&&(null!=t.windowIndex?u=t.windowIndex*s[0].children[0].children.length:("nextThumb"==t.dir&&(u=l+1),"prevThumb"==t.dir&&(u=l-1),"nextWindow"==t.dir&&(u=c+s[0].children[0].children.length),"prevWindow"==t.dir&&(u=c-s[0].children[0].children.length))),s.length)for(var p=s[0].getElementsByClassName("kThumb"),v=p.length;v--;)if(p[v].getAttribute("data-index")==u){i=p[v],a=i.parentNode;break}if(a){var m=n.rtl?"right":"left";if(o!=a){u>c?(o.style[m]=-e.offsetWidth+"px",a.style[m]=e.offsetWidth/2+"px"):(o.style[m]=e.offsetWidth+"px",a.style[m]=-e.offsetWidth/2+"px"),a.style.display="none",setTimeout((function(){a.style.display="block",setTimeout((function(){a.style[m]=0}),20)}),20);var h=e.getElementsByClassName("kMapItem");h.length&&(o&&kInteractive.c.removeClass(h[kInteractive.getChildIndex(o)],"active"),kInteractive.c.addClass(h[kInteractive.getChildIndex(a)],"active")),kInteractive.c.addClass(a,"active"),kInteractive.c.removeClass(o,"active")}t.highlightThumb&&(kInteractive.c.removeClass(d,"active"),kInteractive.c.addClass(i,"active"))}},dimBtns:function(e){for(var t,n=e.getElementsByClassName("kThumbWindow"),i=n.length;i--;)if(kInteractive.c.hasClass(n[i],"active")){t=n[i];break}if(t){var a=e.getElementsByClassName("thumbNavBtn");for(i=0;i<a.length;i++)kInteractive.c.hasClass(a[i],"next")?t.nextElementSibling?kInteractive.c.removeClass(a[i],"disable"):kInteractive.c.addClass(a[i],"disable"):kInteractive.c.hasClass(a[i],"prev")&&(t.previousElementSibling?kInteractive.c.removeClass(a[i],"disable"):kInteractive.c.addClass(a[i],"disable"))}var r=e.getElementsByClassName("imgContainer");if(r.length){var s=kInteractive.c.hasClass(r[0],"selected"),o=kInteractive.c.hasClass(r[r.length-1],"selected"),c=e.getElementsByClassName("btn");for(i=0;i<c.length;i++)kInteractive.c.hasClass(c[i],"next")?o?kInteractive.c.addClass(c[i],"disable"):kInteractive.c.removeClass(c[i],"disable"):kInteractive.c.hasClass(c[i],"prev")&&(s?kInteractive.c.addClass(c[i],"disable"):kInteractive.c.removeClass(c[i],"disable"))}},getState:function(e){var t={};t.images=e.getElementsByClassName("images")[0],t.selectedImg=t.images.getElementsByClassName("selected"),t.imgContainer=e.getElementsByClassName("imgContainer"),t.thumbWindows=e.getElementsByClassName("kThumbWindows");for(var n=0;n<t.imgContainer.length;n++)if(kInteractive.c.hasClass(t.imgContainer[n],"selected")){t.selectedIndex=n;break}if(t.thumbWindows.length){var i=t.thumbWindows[0].getElementsByClassName("active");for(n=0;n<i.length;n++)kInteractive.c.hasClass(i[n],"kThumbWindow")?(t.activeWindow=i[n],t.currentIndex=Number(t.activeWindow.children[0].getAttribute("data-index"))):t.currentThumb=i[n]}return t},goToFullscreen:function(e){if(kInteractive.frameIsOpen=!0,!kInteractive.c.hasClass(e,"fullscreen")){var t=document.createElement("div");t.innerHTML=e.outerHTML;var n=t.children[0];document.body.appendChild(n);var i=this.getState(e),a=e.getBoundingClientRect();n.setAttribute("data-index",i.selectedIndex),n.setAttribute("id","kFullscreenGallery"),n.style.top=a.top+"px",n.style.left=a.left+"px",n.style.width=a.width+"px",n.style.height=a.height+"px",kInteractive.listenForSwiping(n),n.addEventListener("swipeleft",(function(){kInteractive.gallery.showImage(n,{dir:"next"})})),n.addEventListener("swiperight",(function(){kInteractive.gallery.showImage(n,{dir:"prev"})}),!1),"undefined"==typeof isKotobee&&(n.style.position="fixed"),kInteractive.c.addClass(n,"fullscreen"),kInteractive.preRender(n,{singleElem:!0}),kInteractive.postRender(n,{singleElem:!0}),setTimeout((function(){kInteractive.c.addClass(n,"in")}),20)}},showImage:function(e,t){t||(t={});var n=kInteractive.readData(e),i=this.getState(e),a=i.images,r=i.selectedImg,s=i.imgContainer,o=t.index;null==o&&r.length&&(o=kInteractive.getChildIndex(r[0])+("next"==t.dir?1:-1)),o<0&&(o=0),null==o&&(o=0),r.length&&kInteractive.c.removeClass(r[0],"selected"),kInteractive.c.addClass(s[o],"selected");var c=n.rtl?"right":"left";s[o].style[c]=a.offsetWidth*o+"px",s[o].style.display="block",a.style[c]=-a.offsetWidth*o+"px",this.goToThumb(e,{index:o,highlightThumb:!0});var l=e.getElementsByClassName("imgCaption");if(l.length){var d=(l=l[0]).getElementsByClassName("inner");if(d.length){if((d=d[0]).style.display="none",s[o].hasAttribute("data-caption")&&(d.innerHTML=s[o].getAttribute("data-caption"),n.captionFontSize&&(d.style.fontSize=n.captionFontSize+"em"),n.captionColor&&(d.style.color=n.captionColor),d.style.display=null),!n.footerOverlap){var u=e.getElementsByClassName("imgMask");if(!u.length)return;u=u[0];var p=e.getElementsByClassName("kFooter")[0];u.style.bottom=p.offsetHeight+"px"}if(n.slideshowMode){var v=function(){clearTimeout(kInteractive.gallery.timer);var t=e.getElementsByClassName("timerIcon")[0];t&&t.parentNode.removeChild(t)},m=function(){if(v(),n.slideshowTimer){var t=e.getElementsByClassName("timerIcon")[0];t||((t=document.createElement("div")).className="timerIcon",t.innerHTML='<svg><circle r="18" cx="20" cy="20"></circle></svg>',e.appendChild(t));var i=t.getElementsByTagName("circle")[0];i&&(i.style.animationDuration=h+"s")}kInteractive.gallery.timer=setTimeout((function(){var t=e.getElementsByClassName("next")[0];t&&(kInteractive.c.hasClass(t,"disable")?kInteractive.gallery.showImage(e,{index:0}):kInteractive.gallery.showImage(e,{dir:"next"}),kInteractive.gallery.dimBtns(e))}),1e3*h)};if(!document.body.contains(e))return;var h=n.transitionTime;h&&!isNaN(h)||(h=5),kInteractive.gallery.timer||(e.addEventListener("mouseover",v),e.addEventListener("mouseout",m)),m()}}}},zoomImage:function(e,t){var n=this.getState(e).selectedImg[0],i=function(e){var t=window.getComputedStyle(e).transform;if("none"===t)return 1;var n=t.match(/^matrix\((.+)\)$/);if(n){var i=n[1].split(", "),a=parseFloat(i[0]);parseFloat(i[3]);return a}var r=t.match(/^matrix3d\((.+)\)$/);if(r){i=r[1].split(", "),a=parseFloat(i[0]),parseFloat(i[5]);return a}return 1}(n)+.2*("in"==t?1:-1);"fit"==t&&(i=null);!function(e,t){if(!t)return e.style.transform=null;t<1&&(t=1);e.style.transform="scale("+t+")"}(n,i)},detectKey:function(e){27==e.keyCode&&kInteractive.gallery.exitFullscreen()},exitFullscreen:function(){var e=document.getElementById("kFullscreenGallery");e&&(kInteractive.c.removeClass(e,"in"),e.style.opacity=0,setTimeout((function(){e.parentNode.removeChild(e),document.removeEventListener("keydown",kInteractive.gallery.detectKey)}),1e3))},resize:function(e){var t=kInteractive.readData(e);if(t&&(kInteractive.checkResponsiveFloat(t,e),t.thumbnails)){var n=kInteractive.gallery.getState(e).selectedIndex;null==n&&(e.getAttribute("data-index"),n||(n=0));var i=e.getElementsByClassName("kThumbs")[0];i.innerHTML="";var a=50;"small"==t.thumbSize?a=40:"large"==t.thumbSize&&(a=60);var r,s=Math.floor((e.offsetWidth-80)/a),o=document.createElement("div");o.className="kThumbWindows";for(var c=0;c<t.imgs.length;c++)if(t.imgs[c].thumbPath){var l=document.createElement("a");l.className="ki-btn kThumb"+(c==n?" active":""),l.setAttribute("data-index",c);var d="undefined"==typeof isKotobee?t.imgs[c].thumbPath:ph.join(kInteractive.absoluteURL,t.imgs[c].thumbPath);d=kInteractive.cleanURL(d),l.setAttribute("style","background-image:url('"+d+"')"),("undefined"==typeof isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&l.addEventListener("click",kInteractive.actionEvent),c%s==0&&((r=document.createElement("div")).className="kThumbWindow",t.rtl&&r.setAttribute("dir","rtl"),o.appendChild(r)),c==n&&kInteractive.c.addClass(r,"active"),r.appendChild(l)}if(i.appendChild(o),t.thumbMap){var u=document.createElement("div");u.className="kThumbMap",t.rtl&&u.setAttribute("dir","rtl");for(c=0;c<t.imgs.length;c++)if(c%s==0){var p=document.createElement("a");p.className="ki-btn kMapItem"+(c==n?" active":""),u.appendChild(p),("undefined"==typeof isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&p.addEventListener("click",kInteractive.actionEvent)}i.appendChild(u)}if(o.children.length>1){var v=document.createElement("a");v.className="thumbNavBtn next",i.appendChild(v);var m=document.createElement("a");m.className="thumbNavBtn prev",i.appendChild(m),("undefined"==typeof isKotobee||kInteractive.c.hasClass(e,"fullscreen"))&&(v.addEventListener("click",kInteractive.actionEvent),m.addEventListener("click",kInteractive.actionEvent))}}}},kInteractive.image={preRender:function(e,t){var n=kInteractive.readData(e);n&&(n.style&&kInteractive.c.addClass(e,n.style),n.popup&&n.splash&&(e.src=n.splash),e.parentNode&&kInteractive.hasClass(e.parentNode,"link")||"undefined"==typeof isKotobee&&e.addEventListener("click",kInteractive.actionEvent))},postRender:function(e,t,n){kInteractive.readData(t)},action:function(e,t,n){if(t.parentNode&&kInteractive.hasClass(t.parentNode,"kInteractive")&&kInteractive.hasClass(t.parentNode,"link"))kInteractive.action(t.parentNode,event);else{var i=kInteractive.readData(t);if(i){var a=i.behavior;if("none"!=a)r(t,"none"),s(t,"none"),o(t,"none"),setTimeout((function(){"wiggle"==a?(r(t,"wiggle"),s(t,"0.5s"),o(t,"1")):"jump"==a?(r(t,"jump"),s(t,"0.7s"),o(t,"1")):"scale"==a&&(r(t,"scale"),s(t,"0.5s"),o(t,"1"));var e=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();e&&t.addEventListener(e,(function n(i){r(t,"none"),s(t,"none"),o(t,"none"),t.removeEventListener(e,n)}))})),kInteractive.tinCan({verb:"clicked",activity:a+"image: "+t.getAttribute("src")});else;}}function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function s(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function o(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}},resize:function(e){var t=kInteractive.readData(e);t&&kInteractive.checkResponsiveFloat(t,e)}},kInteractive.link={preRender:function(e,t){var n=kInteractive.readData(e);if(n&&!kInteractive.isEditorMode()){if("#"==e.getAttribute("href")&&e.setAttribute("href",""),"div"==e.nodeName.toLowerCase()){var i=document.createElement("a"),a=e.getAttribute("href")?e.getAttribute("href"):n.href;e.getAttribute("data-href")&&(a=e.getAttribute("data-href")),a||(a=""),i.setAttribute("href",a),i.setAttribute("target",n.target?n.target:""),i.setAttribute("style",e.getAttribute("style")),i.setAttribute("data-kotobee",e.getAttribute("data-kotobee")),i.setAttribute("data",e.getAttribute("data-kotobee")),i.className=e.className,e.id?i.id=e.id:n.id&&(i.id=n.id),kInteractive.c.addClass(i,"btn"),i.style.opacity=Number(n.transparency)/100,e.parentNode.replaceChild(i,e),e=i}"undefined"==typeof isKotobee&&("popup"!=n.type&&"audio"!=n.type&&"action"!=n.type||e.setAttribute("onclick","return false;"),e.addEventListener("click",kInteractive.actionEvent))}},postRender:function(e,t,n){},action:function(e,t,n){var i=kInteractive.readData(t);if(i){if("popup"==i.type){var a="<div class='kbAlertScroll'>"+i.msg+"</div>";if(a=a.replace(/src="(.*?)"/g,(function(){var e=arguments[1];return"undefined"!=typeof isKotobee&&(e=ph.join(kInteractive.absoluteURL,e)),'src="'+e+'"'})),"image"==i.popupMode){var r=i.popupImg;"undefined"!=typeof isKotobee&&(r=i.relToRoot?ph.join(bookPath,r):ph.join(kInteractive.absoluteURL,r)),a="<img src='"+(r=kInteractive.cleanURL(r))+"'/>"}kInteractive.alert({content:a}),setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("popup",i.msg),t.description="Shown popup message: "+i.msg,t.type="other",t.learnerResponses="Shown",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"popup",param:i.msg,elem:e,data:i})}))}else if("action"==i.type){var s=i.asset,o=i.action;if(s.remote){if("widget"==s.type){var c=document.createElement("div");c.className="kInteractive widget kbHidden",c.setAttribute("data-kotobee",s.data),c.setAttribute("data",s.data),document.body.appendChild(c),kInteractive.trigger("click",c)}return}for(var l=document.getElementsByClassName(s.classname),d=0;d<l.length;d++)if(kInteractive.hasClass(l[d],"kInteractive")&&kInteractive.hasClass(l[d],s.type))if("activate"==o)if("gallery"==s.type){var u=l[d].getElementsByClassName("next");kInteractive.trigger("click",u[0])}else if("questions"==s.type){for(var p=l[d].getElementsByClassName("ki-btn"),v=0;v<p.length;v++)if("submit"==p[v].type){kInteractive.trigger("click",p[v]);break}}else kInteractive.trigger("click",l[d]);else"visibility"==o&&kInteractive.c.toggleClass(l[d],"kbHidden")}else if("audio"==i.type){var m=function(){h||(kInteractive.c.addClass(y,"hide"),h=!0)};kInteractive.stopCurrentMedia();var h,f=document.createElement("audio"),g=i.src;"file"==i.audioType&&(g="undefined"==typeof isKotobee?i.audio:ph.join(kInteractive.absoluteURL,i.audio)),g=kInteractive.cleanURL(g),f.setAttribute("src",g);var k=document.createElement("div");k.className="kiAudioLoader",k.style.transform=k.style.webkitTransform=k.style.mozTransform="scale(1)";var y=document.createElement("div");if(y.className="kiAudioSpinner",k.appendChild(y),t.parentNode.insertBefore(k,t),f.onplaying=m,setTimeout(m,5e3),f.play(),kInteractive.currentAudio=f,kInteractive.tinCan({verb:"played",activity:"Audio: "+g}),kInteractive.scorm){var b={};b.id=kInteractive.getScormId(t.textContent,g),b.description="Played audio link: "+g,b.type="other",b.learnerResponses="Played",b.objective=i.options?i.options.objective:null,b.timestamp=new Date,kInteractive.scorm.setInteractions([b])}kInteractive.events&&kInteractive.events.add({action:"audioLinkClicked",param:g,elem:e,data:i})}else if("attachment"==i.type){var I=i.file;if("undefined"!=typeof isKotobee&&(I=i.relToRoot?ph.join(bookPath,i.file):ph.join(kInteractive.absoluteURL,i.file)),"undefined"!=typeof kotobee&&isNative)return void angular.element(document.body).scope().getService("crdv").mobileDownload(I);var C=document.createElement("a");document.body.appendChild(C),C.setAttribute("style","display: none"),C.href=kInteractive.cleanURL(I),C.target="_blank",C.download=i.file.split("/")[i.file.split("/").length-1],C.setAttribute("onclick","");var w=document.createEvent("MouseEvents");w.initMouseEvent("click"),C.dispatchEvent(w),C.remove()}return!1}}},kInteractive.lipsync={preRender:function(e,t){},postRender:function(e,t,n){var i,a=e.createDocumentFragment(),r=kInteractive.readData(t);t.setAttribute("id",i="ki-lipsync-"+n),t.innerHTML="";var s=document.createElement("div");if(s.className="container",r.sync){var o=document.createElement("div");o.className="audioContainer";var c=document.createElement("a");c.className="playBtn ki-btn",c.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&c.addEventListener("click",kInteractive.actionEvent),o.appendChild(c);var l=document.createElement("div");l.setAttribute("id",i+"-container"),l.className="playerContainer",o.appendChild(l),r.interaction.playBtn?r.interaction.btnAlignment&&kInteractive.c.addClass(o,r.interaction.btnAlignment):o.style.display="none",s.appendChild(o)}var d=document.createElement("div");d.className="contentContainer",d.innerHTML=function(e){document.createElement("div");var t=/(>)([^<\n]*?[^<]+?)(<[^\/])/g;e=e.replace(/([< \/][^>]*?>)((\s*[^<\s]+\s+?)+)([^<\s]+\s*)(<)/g,(function(e,t){if(arguments[1].indexOf('class="parsed"')>=0)return e;if(0==arguments[1].indexOf("<pre"))return e;if(0==arguments[1].indexOf("<code"))return e;if(0==arguments[1].indexOf("<script"))return e;var n=arguments[2].split(" ");""==n[n.length-1]&&n.splice(-1,1),n.push(arguments[4]);for(var i="",a=0;a<n.length;a++){var r=a==n.length-1?"":" ";i+="<span>"+n[a]+r+"</span>"}return arguments[1]+i+"<"})),t&&(e=e.replace(t,(function(e,t){return arguments[2].trim()?arguments[1]+("<span>"+arguments[2]+"</span>")+arguments[3]:e})));return e=e.replace(/(<a [\s\S]*?)(>)/g,'$1 onclick="return false;" $2'),e=e.replace(/&nbsp;/g,"&#160;"),e}(r.content),s.appendChild(d);var u=document.createElement("div");r.style&&kInteractive.c.addClass(u,r.style),a.appendChild(s),u.appendChild(a),t.appendChild(u);var p=document.createElement("style");p.className="system parsed";var v="";if(v+="#"+i+" .lipSyncCurrentWord {",v+="color:"+r.layout.color+";",r.layout.underline&&(v+="text-decoration:underline;"),r.layout.scale&&Number(r.layout.scale)>1&&(v+="transform:scale("+r.layout.scale+");",v+="padding:0 3px;",v+="display:inline-block;"),v+="}",p.innerHTML=v,t.appendChild(p),r.autoplay)kInteractive.action(t)},action:function(e,t){kInteractive.stopCurrentMedia();var n=kInteractive.readData(e);if(n){n.audioType||(n.audioType=n.type);e.getAttribute("id");e.getElementsByClassName("playBtn")[0].className="playBtn ki-btn hide";var i=n.src;if("file"==n.audioType&&(i="undefined"==typeof isKotobee?n.audio:n.relToRoot?ph.join(bookPath,n.audio):ph.join(kInteractive.absoluteURL,n.audio)),kInteractive.scorm){var a={};a.id=kInteractive.getScormId(e.getAttribute("id"),i),a.description="Played audio: "+i,a.type="other",a.learnerResponses="Played",a.objective=n.options?n.options.objective:null,a.timestamp=new Date,kInteractive.scorm.setInteractions([a])}kInteractive.events&&kInteractive.events.add({action:"audioPlayed",param:i,elem:e,data:n});var r=document.createElement("audio");r.setAttribute("controls","true"),r.setAttribute("autoplay","true"),r.setAttribute("data-tap-disabled","false");var s=document.createElement("source");s.src=kInteractive.cleanURL(i),r.appendChild(s),r.appendChild(document.createTextNode("Your browser does not support the audio element")),r.className="ki-noHighlight",r.oncanplay=function(){kInteractive.currentAudio==e&&kInteractive.tinCan({verb:"played",activity:"Audio: "+i})},r.ontimeupdate=function(e){!function(e){var t,i=n;for(var a=i.sync.length;a--;)if(e>=i.sync[a]){t=a;break}if(null==t)return;c!=t&&(null!=c&&o[c]&&kInteractive.c.removeClass(o[c],"lipSyncCurrentWord"),o[t]&&kInteractive.c.addClass(o[t],"lipSyncCurrentWord"),c=t)}(r.currentTime)},n.interaction.nextAuto&&(r.onended=function(t){var n=[].slice.call(document.getElementsByClassName("lipsync"));if(n.length){var i=n.indexOf(e),a=n[i+1];if(a){var r=a.getElementsByClassName("playBtn")[0];r&&r.click()}}}),e.getElementsByClassName("playerContainer")[0].appendChild(r),r.play(),kInteractive.currentAudio=e,kInteractive.c.addClass(kInteractive.currentAudio,"playing");var o=function(){for(var t=[],n=e.getElementsByClassName("contentContainer")[0],i=n.getElementsByClassName("lipSyncCurrentWord"),a=i.length;a--;)hasClass(i[a],"lipSyncCurrentWord")&&removeClass(i[a],"lipSyncCurrentWord");for(;n.children&&n.children.length;)n=n.children[0];t.push(n);for(;n;)if(n.nextSibling){for(n=n.nextSibling;n.children&&n.children.length;)n=n.children[0];if(3==n.nodeType)continue;if(""==n.textContent.trim())continue;t.push(n)}else if("contentContainer"==(n=n.parentNode).className)break;return t}(),c=0;kInteractive.c.addClass(o[c],"lipSyncCurrentWord")}}},kInteractive.questions={preRender:function(e,t,n,i){i||(i={});var a=t.createDocumentFragment(),r=kInteractive.readData(e);if(r){var s=r.dict,o=r.userDict;if(s||(s={}),o||(o=s),r.options||(r.options={}),e.id||(e.id="ki-qs-"+n+"-"+Math.ceil(1e3*Math.random())),e.innerHTML="",r.layout&&r.layout.popup&&!kInteractive.hasClass(e,"inpopup")){var c=document.createElement("img");c.className="clickable";var l=r.layout.popupImg;return l=kInteractive.cleanURL(l),c.src=l,a.appendChild(c),"undefined"==typeof isKotobee&&c.addEventListener("click",kInteractive.actionEvent),void e.appendChild(a)}if(r.options.randomize){for(var d=0;d<r.q.length;d++)r.q[d].origin=d;for(var u,p,v=r.q.length;0!==v;)p=Math.floor(Math.random()*(r.q.length-1e-4)),v--,u=r.q[v],r.q[v]=r.q[p],r.q[p]=u;if("slides"==r.options.displayMode){var m="";for(d=0;d<r.q.length;d++)m+=(m?",":"")+r.q[d].origin;e.setAttribute("data-o",m)}}if(r.options.questionsDisplayed){var h=Number(r.options.questionsDisplayed);r.q=r.q.slice(0,h)}if(r.title){var f=document.createElement("span");f.innerHTML="<h4>"+kInteractive.escapeHtml(r.title)+"</h4>",kInteractive.c.hasClass(e,"parsed")&&kInteractive.c.addClass(f.children[0],"parsed"),a.appendChild(f)}var g=null;r.options&&r.options.emailForm&&(g=this.f.createEmailForm(o));var k=null;"none"!=r.action&&(k=this.f.createSubmitBtn(o,e));var y=null,b=null,I=null;r.options&&r.options.clearAnswers&&(y=this.f.createClearBtn(o)),r.options&&r.options.addToNotebook&&(I=this.f.createAddToNotebookBtn(o)),r.options&&r.options.preserveAnswers&&!r.options.preserveAnswers.auto&&(b=this.f.createPreserveBtn(o,e,r.layout.persist||{}));var C=this.f.createSeparator(),w=document.createElement("div");w.className="qContainer";var E=document.createElement("div");if(E.className="btnContainer","slides"==r.options.displayMode)e.qIndex=0,w.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:1,index:0,elem:e,rendered:!1})),kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!i.skipDateValidation&&(w.style.display="none",E.style.display="none"),a.appendChild(w),a.appendChild(E),kInteractive.questions.f.showNavBtns(0,a,{isFrag:!0,userDict:o,qsData:r});else{var x=0;for(d=0;d<r.q.length;d++)"sp"!=r.q[d].type&&x++,w.appendChild(kInteractive.questions.f.createQElem(r,{questionNo:x,index:d,elem:e,rendered:!1}));kInteractive.isEditorMode()||r.options.dateRangeEnabled&&!i.skipDateValidation&&(w.style.display="none",E.style.display="none"),a.appendChild(w),b&&E.appendChild(b),g&&E.appendChild(g),k&&E.appendChild(k),I&&E.appendChild(I),y&&E.appendChild(y),C&&a.appendChild(C),a.appendChild(E)}r.options.rtl?(e.setAttribute("dir","rtl"),kInteractive.c.addClass(e,"rtl")):e.setAttribute("dir","ltr");var A=document.createElement("div");r.style&&kInteractive.c.addClass(A,r.style),A.appendChild(a),"undefined"==typeof isKotobee&&kInteractive.c.addClass(A,"parsed"),e.appendChild(A)}},postRender:function(e,t,n,i){var a=kInteractive.readData(t);if(a){i||(i={});var r=a.dict;r||(r={}),(P=a.userDict)||(P=r);for(var s=t.getElementsByClassName("ques"),o=t.getElementsByClassName("explanation"),c=o.length;c--;)o[c].parentNode.removeChild(o[c]);var l=t.getElementsByClassName("reference");for(c=l.length;c--;)l[c].parentNode.removeChild(l[c]);if(a.options.scoreHistory&&kInteractive.isKotobeeUser()){var d=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",u=angular.element(document.body).scope(),p={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:u.data.user.email,code:u.data.user.code,pwd:u.data.user.pwd,qsxid:t.id,mode:"submissions"};"library"==config.kotobee.mode&&u.data.book&&(p.bid=u.data.book.id),kInteractive.questions.f.sendPost(d,p,(function(e){e.target;var n=e.target;if(4===n.readyState&&200===n.status){var i=JSON.parse(n.response);if(i&&i.scores&&i.scores.length){for(var a=t.getElementsByClassName("scoreHistory"),r=a.length;r--;)a[0].parentNode.removeChild(a[0]);var s=document.createElement("div");s.className="scoreHistory";var o=document.createElement("h5");o.textContent=P.scoreHistoryLabel?P.scoreHistoryLabel:"Score history",s.appendChild(o);for(r=0;r<i.scores.length;r++){var c=i.scores[r],l=kInteractive.questions.f.phpDateToJs(c.date),d=(P.scoreLabel?P.scoreLabel:"Score")+": "+c.fullscore,u=document.createElement("div");u.className="scoreItem",u.innerHTML="<div><span class='date'>"+l.toLocaleString()+"</span> <span class='score'>"+d+"</span></div>",s.appendChild(u)}t.appendChild(s)}}}))}if(kInteractive.isEditorMode()||!a.options.dateRangeEnabled||i.skipDateValidation){if(!kInteractive.isEditorMode()){var v=kInteractive.getBookID()+"-"+t.id;t.clock=kInteractive.getClock(v),t.clock.pause(),t.clock.cb=function(e){if(a.options.visibilityDuration){var n=a.options.visibilityDuration-e;if(a.options.visibilityDurationTimer){var i=t.getElementsByClassName("qTimer")[0];i||((i=document.createElement("div")).className="qTimer",t.appendChild(i));var r=Math.floor(n/60),s=n-60*r;i.textContent=("0"+r).substr(-2)+":"+("0"+s).substr(-2)}if(n<0){if(a.options.visibilityDurationAutoSubmit){var o=t.getElementsByClassName("questions-submit")[0];o&&o.click()}kInteractive.questions.f.replaceWithError(t,{msg:P.questionsTimeUp?P.questionsTimeUp:P.questionsInactive,className:"qInactive"})}}};try{kInteractive.observe(t,(function(){t.clock&&t.clock.resume()}),(function(){t.clock&&t.clock.pause()}))}catch(e){}}kInteractive.isEditorMode()||a.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(t,(function(e){e&&e>=a.options.disableAfterAttempts&&kInteractive.questions.f.replaceWithError(t,{msg:P.questionsInactive,className:"qInactive"})}));for(var m=0;m<s.length;m++){var h=s[m].getElementsByClassName("ans"),f=(h.length,m);a.options.randomize&&(f="slides"==a.options.displayMode&&t.originArray?t.originArray[m]:Number(s[m].getAttribute("data-o"))),document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]&&kInteractive.questions.f.showExp(a.userDict,s[m],a.q[f],a.options);for(c=0;c<h.length;c++)if(kInteractive.c.removeClass(h[c].parentNode,"correct"),h[c].getAttribute("id").indexOf("ki-tf-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]&&(document[t.id].q[f][c]?h[c].setAttribute("checked",!0):h[c].removeAttribute("checked"),a.options&&a.options.highlightCorrect&&(0==c&&a.q[f].a||1==c&&!a.q[f].a)&&kInteractive.c.addClass(h[c].parentNode,"correct"));else if(h[c].getAttribute("id").indexOf("ki-dd-")>=0){if(document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f])for(var g=0;g<document[t.id].q[f].length;g++){var k=document[t.id].q[f][g];try{for(var y=document.getElementById(k.id),b=y;!kInteractive.c.hasClass(b,"ques");)b=b.parentNode;b.getElementsByClassName("categoryContainer")[0].children[k.category].appendChild(y)}catch(e){}}}else if(h[c].getAttribute("id").indexOf("ki-na-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]&&(h[c].removeAttribute("value"),document[t.id].q[f]&&h[c].setAttribute("value",document[t.id].q[f]));else if(h[c].getAttribute("id").indexOf("ki-sa-")>=0)document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]&&(h[c].removeAttribute("value"),document[t.id].q[f]&&h[c].setAttribute("value",document[t.id].q[f]));else if(h[c].getAttribute("id").indexOf("ki-mt-")>=0){var I=s[m].getElementsByClassName("mt-container")[0];if(!I)continue;if(document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]){var C=document[t.id].q[f];C&&C.length&&(I.mtSelection||(I.mtSelection={pairs:[]}),I.mtSelection.pairs=C,"function"==typeof kInteractive.questions.mt.redrawLines&&kInteractive.questions.mt.redrawLines(I))}if(a.options&&a.options.highlightCorrect){var w=a.q[f];if(w&&w.left&&w.right){for(var E={},x=0;x<w.left.length;x++)E[w.left[x]]=w.right[x];I.mtSelection&&I.mtSelection.pairs&&I.mtSelection.pairs.forEach((function(e){if(E[e.left]===e.right){var t=document.getElementById(e.leftId);t&&kInteractive.c.addClass(t,"correct");var n=document.getElementById(e.rightId);n&&kInteractive.c.addClass(n,"correct")}}))}}}else document[t.id]&&document[t.id].preserve&&document[t.id].q&&document[t.id].q[f]&&(document[t.id].q[f][c]?h[c].setAttribute("checked",!0):h[c].removeAttribute("checked"),a.options&&a.options.highlightCorrect&&a.q[f].c[c].a&&kInteractive.c.addClass(h[c].parentNode,"correct"));if(document[t.id]){var A=t.getElementsByClassName("questions-preserve");A.length&&(document[t.id].preserve?A[0].setAttribute("checked",!0):A[0].removeAttribute("checked"))}}for(var N=t.getElementsByClassName("ih-container"),q=0;q<N.length;q++){var L=N[q],S=L.querySelector("svg.ih-overlay");if(S&&(document[t.id]&&document[t.id].q)){var D=L.dataset.qid,T=document[t.id].q[D];T&&Array.isArray(T)&&(L.answers=[],S.innerHTML="",T.forEach((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",6),t.setAttribute("fill",e.correct?"rgba(0,255,0,0.6)":"rgba(255,0,0,0.6)"),S.appendChild(t),L.answers.push(e)})),L.clickCount=L.answers.length)}}if(!kInteractive.isEditorMode()&&!kInteractive.isPreview()){var B="persist-"+kInteractive.getBookID()+"-"+t.id,R="true"==sessionStorage.getItem(B)||a.options.preserveAnswers.auto,M=t.querySelector("input.questions-preserve");if(M&&(R?M.setAttribute("checked",!0):M.removeAttribute("checked")),kInteractive.helpers&&kInteractive.helpers.persister)if(kInteractive.helpers.persister.instances[t.id])kInteractive.helpers.persister.instances[t.id]instanceof kPersister&&kInteractive.helpers.persister.instances[t.id].restore();else{var O={storage:a.options.preserveAnswers.option,enabled:R,root:t,silentMode:a.options.preserveAnswers.auto,appendDataMode:"slides"==a.options.displayMode,delegateEvents:!1,messages:{save:P.save?P.save:"Save",unsaved:P.unsaved?P.unsaved:"You have unsaved changes",saving:P.saving?P.saving:"Saving ..",saved:P.saved?P.saved:"Changes has been saved!",dismiss:P.dismiss?P.dismiss:"Dismiss",lastSaved:P.lastSaved?P.lastSaved:"Last saved on",longDataError:P.longDataError?P.longDataError:"Some answers not saved (marked in red)"}};Object.keys(a.options.preserveAnswers).some((function(e){return-1!=e.indexOf("design")}))&&(O.design=function(e){var t={};e.designPlacement&&(t.placement=e.designPlacement);(e.designUnsavedColor||e.designUnsavedBackground)&&(t.unsaved={});e.designUnsavedColor&&(t.unsaved.color=e.designUnsavedColor);e.designUnsavedBackground&&(t.unsaved.background=e.designUnsavedBackground);(e.designSuccessColor||e.designSuccessBackground)&&(t.success={});e.designSuccessColor&&(t.success.color=e.designSuccessColor);e.designSuccessBackground&&(t.success.background=e.designSuccessBackground);return t}(a.options.preserveAnswers)),kInteractive.helpers.persister.addInstance(t.id,O),kInteractive.helpers.persister.instances[t.id].on("persister.ready",(function(e){e.target.enabled&&e.target.restore()})),kInteractive.helpers.persister.instances[t.id].on("persister.restored",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.error",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.saved",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.unsaved",(function(e){})),kInteractive.helpers.persister.instances[t.id].on("persister.pushed",(function(e){})),kInteractive.helpers.persister.instances[t.id].init()}}}else{var P=a.userDict,H="https://www.kotobee.com/";"undefined"!=typeof isKotobee&&(H=config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/");d=H+"timestamp";kInteractive.questions.f.sendPost(d,{timezone:kInteractive.getTimezone()},(function(n){var r=n.target;if(4===r.readyState&&200===r.status){var s=r.responseText,o=kInteractive.questions.f.checkTimeValidity(s,a.options.dateRange);if(o.valid){var c=t.getElementsByClassName("qContainer")[0],l=t.getElementsByClassName("btnContainer")[0];c&&(c.style.display="block"),l&&(l.style.display="block");var d=Object.assign({},i,{skipDateValidation:!0});kInteractive.questions.postRender(e,t,g,d)}else o.expired?kInteractive.questions.f.replaceWithError(t,{msg:P.questionsExpired,className:"qExpired"}):o.early&&kInteractive.questions.f.replaceWithError(t,{msg:P.questionsNotStarted,className:"qEarly"})}}))}}},action:function(e,t){var n=kInteractive.readData(e);if(n){var i=n.dict,a=n.userDict;if(i||(i={}),a||(a=i),n.layout&&n.layout.popup&&!kInteractive.hasClass(e,"inpopup")&&"img"==t.nodeName.toLowerCase()){var r=function(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t},s=document.getElementById("epubContent");s&&e.setAttribute("data-loc",function(e,t){for(var n="";e!=t;){n=r(e)+"."+n,e=e.parentNode}return""==n?"":n.substr(0,n.length-1)}(e,s));var o=document.createElement("iframe");o.setAttribute("nwdisable","true"),o.setAttribute("scrolling","yes");var c=document.createElement("div");return c.className="scroller",c.appendChild(o),n.cb=function(t){var n,i=document.createElement("head");if("undefined"==typeof isKotobee){for(var a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var s=a[r];if(s.getAttribute("href").indexOf("base.css")>=0){var l=s.getAttribute("href").split("/");delete l[l.length-1],n=l.join("/");break}}if(!n)return}var d="undefined"==typeof isKotobee?kInteractive.c.removeHash(window.location.href):kInteractive.absoluteURL;d=kInteractive.cleanURL(kInteractive.c.removeFilename(d)+"/"),"undefined"!=typeof isKotobee&&(kInteractive.isAbsolutePath(d)||(d=kInteractive.cleanURL(kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+d)));for(var u=d.split("EPUB/xhtml"),p=u[u.length-1].split("/").length-1,v="",m=0;m<p;m++)v+="../";i="<head>";if(i+='<base href="'+d+'"/>',i+='<link rel="stylesheet" type="text/css" href="'+(v+"css/base.css")+'" />',i+='<link rel="stylesheet" type="text/css" href="'+(v+"css/global.css")+'" />',i+='<link rel="stylesheet" type="text/css" href="'+(v+"css/kotobeeInteractive.css")+'" />',i+='<script type="text/javascript" src="'+(v+"js/kotobeeInteractive.js")+'"><\/script>',i+='<script type="text/javascript" src="'+(v+"js/global.js")+'"><\/script>',"undefined"!=typeof isKotobee){var h=clone(config);h.kotobee.email=angular.element(document.body).scope().data.user.email,i+='<script type="text/javascript">var config='+JSON.stringify(h)+";<\/script>"}i+='<meta name="viewport" content="viewport-fit=cover,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,width=device-width">',i+='<meta charset="utf-8" />',i+="</head>";var f=e.outerHTML;f=(f=(f=(f=(f=(f=f.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var g="<html>"+i+"<body>"+(f+='<div class="vSpace20"></div>')+"</body></html>";o.setAttribute("srcdoc",g);var k="javascript: window.frameElement.getAttribute('srcdoc');";function y(){if("undefined"!=typeof isKotobee){var t={};t.root=o.contentDocument.documentElement.ownerDocument.body,t.rootIndex=e.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(t,(function(){}))}}o.setAttribute("src",k),o.contentWindow&&(o.contentWindow.location=k),t.appendChild(c),o.addEventListener?o.addEventListener("load",y,!0):o.attachEvent&&o.attachEvent("onload",y)},n.closed=function(){},n.pos=n.layout.pos,kInteractive.openFrame(n),kInteractive.tinCan({verb:"opened",activity:"Questions: "+n.title}),void setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("question",n.title),t.description="Opened question popup: "+n.title,t.learnerResponses="Opened",t.type="other",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"questionPopup",param:n.title,elem:e,data:n})}),800)}if(kInteractive.hasClass(t,"ki-inputbox"))kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange();else{if(kInteractive.hasClass(t,"ki-textfield")&&!kInteractive.hasClass(t,"mt-mobile-select"))return kInteractive.questions.fib.resizeFibInput(t),void(kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange());if(kInteractive.hasClass(t,"ki-draggable"))kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange();else if(!kInteractive.hasClass(t,"kInteractive")){if(kInteractive.hasClass(t,"questions-next")){var l=e.qIndex?e.qIndex:0;if(e.questions||(e.questions=[]),++l<0)return;if(l>=n.q.length)return;var d=(u=e.getElementsByClassName("qContainer")[0]).children[0];if(n.options.strictNav)if(!(be=kInteractive.questions.f.assess(d,n.q[l-1],n)).correct)return void kInteractive.questions.f.showExp(n.userDict,d,n.q[l-1],n.options);return e.questions[l-1]||(e.questions[l-1]=d),e.questions[l]||(e.questions[l]=kInteractive.questions.f.createQElem(n,{questionNo:l+1,index:l,elem:e,rendered:!0})),u.innerHTML="",u.appendChild(e.questions[l]),kInteractive.questions.f.showNavBtns(l,e,{userDict:a,qsData:n}),e.qIndex=l,void kInteractive.helpers.persister.instances[e.id].restore()}if(kInteractive.hasClass(t,"questions-prev")){if(!e.questions||!e.questions.length)return;var u;l=e.qIndex?e.qIndex:0;return l--,(u=e.getElementsByClassName("qContainer")[0]).innerHTML="",u.appendChild(e.questions[l]),kInteractive.questions.f.showNavBtns(l,e,{userDict:a,qsData:n}),e.qIndex=l,void kInteractive.helpers.persister.instances[e.id].restore()}if(kInteractive.hasClass(t,"mt-left-item")||kInteractive.hasClass(t,"mt-right-item")||kInteractive.hasClass(t,"mt-mobile-select")){var p=t.closest(".mt-container"),v=p.mtSelection||(p.mtSelection={first:null,pairs:[]});if(kInteractive.hasClass(t,"mt-mobile-select")&&t.nodeName&&"select"===t.nodeName.toLowerCase()){var m=t.getAttribute("data-left")||"",h=t.value||"";if(!m)return;if(!(I=Array.from(p.querySelectorAll(".mt-left-item")).find((function(e){return e.textContent.trim()===m}))))return;var f=I.id,g=parseInt(I.getAttribute("data-ki-index"),10);if(v.pairs=v.pairs.filter((function(e){return e.left!==m&&e.right!==h})),h&&"default"!==h){var k=t.options[t.selectedIndex],y=(C=(w=k?k.id:null)?document.getElementById(w):null)?parseInt(C.getAttribute("data-ki-index"),10):null;p.querySelectorAll(".mt-mobile-select").forEach((function(e){e!==t&&e.value===h&&(e.value="default")})),v.pairs.push({left:m,right:h,leftId:f,rightId:w,leftIndex:g,rightIndex:y})}return kInteractive.questions.mt.redrawLines(p),void(kInteractive.helpers.persister.instances[p.id]&&kInteractive.helpers.persister.instances[p.id].handleChange())}if(!v.first)return v.first=t,void t.classList.add("selected");var b=v.first.classList.contains("mt-left-item");if(b===t.classList.contains("mt-left-item"))return v.first.classList.remove("selected"),v.first=t,void t.classList.add("selected");var I=b?v.first:t,C=b?t:v.first,w=(m=I.textContent.trim(),h=C.textContent.trim(),f=I.id,C.id);v.pairs=v.pairs.filter((function(e){return e.left!==m&&e.right!==h})),v.pairs.push({left:m,right:h,leftId:f,rightId:w}),kInteractive.questions.mt.redrawLines(p),v.first.classList.remove("selected"),v.first=null,kInteractive.helpers.persister.instances[p.id]&&kInteractive.helpers.persister.instances[p.id].handleChange()}if(kInteractive.hasClass(t,"questions-tts")){var E=t.getAttribute("data-text");(ye=new SpeechSynthesisUtterance).text=E,window.speechSynthesis.speak(ye)}if(kInteractive.hasClass(t,"ih-container")||kInteractive.hasClass(t,"ih-image")){var x=(we=t.closest(".ih-container")).querySelector("svg.ih-overlay"),A=we.dataset.qid,N=n.q.find((function(e){return e.id===A}));if(!N||!N.hotspots)return;for(var q=we.answers||[],L=we.getBoundingClientRect(),S=(event.clientX-L.left)/L.width*100,D=(event.clientY-L.top)/L.height*100,T=0;T<q.length;T++)if(R=q[T],M={x:S,y:D},O=void 0,P=void 0,O=R.x-M.x,P=R.y-M.y,Math.sqrt(O*O+P*P)<3)return q.splice(T,1),we.answers=q,we.clickCount=q.length,x.querySelectorAll("circle").forEach((function(e){return e.remove()})),void q.forEach((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x/100*L.width),t.setAttribute("cy",e.y/100*L.height),t.setAttribute("r",8),t.setAttribute("fill","rgba(0,0,255,0.5)"),t.style.cursor="pointer",x.appendChild(t)}));if(q.length>=N.hotspots.length){q[q.length-1]={x:S,y:D},x.querySelectorAll("circle").forEach((function(e){return e.remove()})),q.forEach((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x/100*L.width),t.setAttribute("cy",e.y/100*L.height),t.setAttribute("r",8),t.setAttribute("fill","rgba(0,0,255,0.5)"),x.appendChild(t)})),we.answers=q,we.clickCount=q.length;N.hotspots.every((function(e){return q.some((function(t){return kInteractive.questions.ih.pointInPolygon(t,e.points)}))}));return void(kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange())}var B=document.createElementNS("http://www.w3.org/2000/svg","circle");if(B.setAttribute("cx",S/100*L.width),B.setAttribute("cy",D/100*L.height),B.setAttribute("r",8),B.setAttribute("fill","rgba(0,0,255,0.5)"),B.style.cursor="pointer",x.appendChild(B),q.push({x:S,y:D}),we.answers=q,we.clickCount=q.length,q.length>=N.hotspots.length)N.hotspots.every((function(e){return q.some((function(t){return kInteractive.questions.ih.pointInPolygon(t,e.points)}))}));kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange()}else{var R,M,O,P;if(kInteractive.hasClass(t,"ih-reset-btn")){for(var H=t;H&&(!H.className||-1===String(H.className).indexOf("ques"));)H=H.parentNode;if(!H)return;if(!(we=H.querySelector(".ih-container")))return;if(!(x=we.querySelector("svg.ih-overlay")))return;we.answers=[],we.clickCount=0;for(var j=(xe=x.querySelectorAll("circle")).length-1;j>=0;j--)xe[j].parentNode.removeChild(xe[j]);void 0!==e&&kInteractive.helpers.persister.instances[e.id]&&kInteractive.helpers.persister.instances[e.id].handleChange()}else if(kInteractive.hasClass(t,"questions-clear")){q=e.getElementsByClassName("ans");for(var z=[],F=0;F<q.length;F++)q[F].checked=!1,q[F].value=null,kInteractive.c.removeClass(q[F].parentNode,"correct"),kInteractive.c.removeClass(q[F],"incorrect"),kInteractive.c.removeClass(q[F],"fib-correct"),kInteractive.c.removeClass(q[F],"fib-incorrect"),kInteractive.c.hasClass(q[F].parentNode,"dCategory")&&z.push(q[F]);var K=e.querySelector(".ki-ord-answers");if(K){for(var U=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),i=[e[n],e[t]];e[t]=i[0],e[n]=i[1]}return e}(Array.prototype.slice.call(K.querySelectorAll(".ki-ord-item")));K.firstChild;)K.removeChild(K.firstChild);for(j=0;j<U.length;j++)K.appendChild(U[j])}for(F=0;F<z.length;F++)z[F].parentNode.parentNode.parentNode.getElementsByClassName("ki-dd-answers")[0].appendChild(z[F]);var _=e.getElementsByClassName("explanation");for(F=_.length;F--;)_[F].parentNode.removeChild(_[F]);var W=e.getElementsByClassName("reference");for(F=W.length;F--;)W[F].parentNode.removeChild(W[F]);for(var J=e.getElementsByClassName("mt-container"),G=0;G<J.length;G++){var V=J[G];V.mtSelection={first:null,pairs:[]};for(var Y=V.querySelectorAll(".mt-left-item, .mt-right-item"),X=0;X<Y.length;X++)kInteractive.c.removeClass(Y[X],"selected"),kInteractive.c.removeClass(Y[X],"incorrect");if(x=V.querySelector("svg"))for(;x.firstChild;)x.removeChild(x.firstChild);for(var Q=V.querySelectorAll(".mt-mobile-select"),$=0;$<Q.length;$++)Q[$].value="default"}document[e.id]=null,(we=e.querySelector(".ih-container"))&&((x=we.querySelector("svg.ih-overlay"))&&(x.querySelectorAll("circle").forEach((function(e){return e.remove()})),x.querySelectorAll(".ih-hotspot-feedback").forEach((function(e){return e.remove()}))),we.answers=[],we.clickCount=0,kInteractive.helpers.persister.instances[we.id]&&kInteractive.helpers.persister.instances[we.id].clear()),kInteractive.helpers.persister.instances&&kInteractive.helpers.persister.instances[e.id].clear()}else{if(kInteractive.hasClass(t,"questions-notebook")){var Z=n.layout&&n.layout.popup&&kInteractive.hasClass(e,"inpopup");if("undefined"==typeof isKotobee&&!Z)return void kInteractive.alert({content:i.kotobeeOnly,title:a.sorry?a.sorry:"Sorry"});var ee,te={elem:e};if("undefined"!=typeof isKotobee)angular.element(document.body).scope();else{try{window.parent.getGlobal()}catch(t){var ne=e.getElementsByClassName("ans");for(j=0;j<ne.length;j++)ne[j].checked?ne[j].setAttribute("checked",""):ne[j].removeAttribute("checked");kInteractive.c.addClass(e,"parsed"),te.elem=e.outerHTML;var ie={msg:a.savedToNotebook?a.savedToNotebook:"Saved to notebook!",nOb:te};return window.parent.postMessage("addtonotebook:"+encodeURIComponent(JSON.stringify(ie)),"*"),void kInteractive.alert({content:a.savedToNotebook?a.savedToNotebook:"Saved to notebook!"})}te.rootIndex=e.getAttribute("data-loc"),te.root=e}return window.compInstances&&window.compInstances.global&&(ee=window.compInstances.global),kInteractive.hasClass(e,"inpopup")&&(ee=window.top.compInstances.global),void(ee&&(kInteractive.c.addClass(t,"busy"),ee.questionsAddToNotebookShortcut(te,(function(){kInteractive.c.removeClass(t,"busy"),kInteractive.alert({content:a.savedToNotebook?a.savedToNotebook:"Saved to notebook!"})}))))}if(kInteractive.hasClass(t,"questions-preserve")){if(document[e.id]||(document[e.id]={}),document[e.id].preserve=t.checked,kInteractive.helpers.persister.instances){var ae="persist-"+kInteractive.getBookID()+"-"+e.id;t.checked?(sessionStorage.setItem(ae,"true"),kInteractive.helpers.persister.instances[e.id].enable(n.options.preserveAnswers.auto)):(sessionStorage.setItem(ae,"false"),kInteractive.helpers.persister.instances[e.id].disable())}}else if(kInteractive.hasClass(t,"questions-submit")){var re=function(){var e="Questions: "+se+". Score: "+le+" questions out of "+me;e+=". Action: "+Te,"selfAnswerReport"==Te&&(e+=". Details: "+de),kInteractive.tinCan({verb:"solved",activity:e})},se="Untitled questions",oe=e.getElementsByTagName("h4");oe.length&&(se=oe[0].textContent||oe[0].data);var ce,le=0,de="",ue=0,pe=0,ve=[];ce="slides"==n.options.displayMode?e.questions.slice(0):e.getElementsByClassName("ques");var me=0;for(F=0;F<ce.length;F++)if(!kInteractive.hasClass(ce[F],"sp")){me++;var he=(q=ce[F].getElementsByClassName("ans")).length,fe=n.q[F],ge=F,ke=kInteractive.questions.f.getItemOrder(e);if(n.options.randomize&&(ge="slides"==n.options.displayMode&&ke?Number(ke[j]):Number(ce[F].getAttribute("data-o")),fe=n.q[ge]),fe.q||(fe.q=""),fe.q=fe.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1"),kInteractive.scorm&&n.options&&n.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(e.id+"-"+me,fe.q))){var ye="<p style='text-align:center'>"+(a.alreadySubmitted?a.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:ye})}var be,Ie={};if(q.length){var Ce=q[0].getAttribute("id");if(ve.push(Ie),Ie.id=kInteractive.getScormId(e.id+"-"+me,fe.q),Ie.qid=e.id,Ce.indexOf("ki-tf-")>=0?Ie.type="true-false":Ce.indexOf("ki-mcq-")>=0||Ce.indexOf("ki-mmcq-")?Ie.type="choice":Ce.indexOf("ki-dd-")>=0?Ie.type="drag-drop":Ce.indexOf("ki-sa-")>=0?Ie.type="short-answer":Ce.indexOf("ki-na-")>=0?Ie.type="numeric-answer":Ce.indexOf("ki-ih-")>=0?Ie.type="image-hotspot":Ce.indexOf("ki-mt-")>=0&&(Ie.type="matching"),kInteractive.hasClass(ce[ge],"ih")){var we=ce[ge].querySelector(".ih-container"),Ee=[];if(we&&we.answers&&(Ee=we.answers.map((function(e){return{x:e.x,y:e.y}}))),x=we?we.querySelector("svg.ih-overlay"):null){L=we.getBoundingClientRect();if(x.querySelectorAll(".ih-hotspot-feedback").forEach((function(e){return e.remove()})),fe.hotspots&&fe.hotspots.length&&n.options.highlightCorrect&&fe.hotspots.forEach((function(e){var t=Ee.some((function(t){return kInteractive.questions.ih.pointInPolygon(t,e.points,we)})),n=document.createElementNS("http://www.w3.org/2000/svg","polygon"),i=e.points.map((function(e){return e.x/100*L.width+","+e.y/100*L.height})).join(" ");n.setAttribute("points",i),n.setAttribute("class","ih-hotspot-feedback"),n.setAttribute("fill",t?"rgba(0,255,0,0.3)":"rgba(255,0,0,0.3)"),n.setAttribute("stroke",t?"green":"red"),n.setAttribute("stroke-width","2"),x.appendChild(n)})),we.answers){var xe=x.querySelectorAll("circle");we.answers.forEach((function(e,t){var n=fe.hotspots.some((function(t){return kInteractive.questions.ih.pointInPolygon(e,t.points,we)}));xe[t]&&xe[t].setAttribute("fill",n?"rgba(0,255,0,0.6)":"rgba(255,0,0,0.6)")}))}}}}Ie.objective=n.options?n.options.objective:null,Ie.timestamp=kInteractive.timestamp,Ie.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),Ie.description=fe.q,(be=kInteractive.questions.f.assess(ce[F],fe,n)).correctResponses&&(Ie.correctResponses=be.correctResponses),be.learnerResponses&&(Ie.learnerResponses=be.learnerResponses);var Ae=be.ddInteractionOb;Ae||(Ae=[]);he=be.correct;if(Ae.length)for(var Ne=0;Ne<Ae.length;Ne++)Ie.correctResponses&&(Ie.correctResponses+="; "),Ie.learnerResponses&&(Ie.learnerResponses+="; "),Ie.correctResponses+=Ae[Ne].correct,Ie.learnerResponses+=Ae[Ne].learner;Ie.result=0,he&&le++,null!=fe.weight&&(ue+=+fe.weight,he&&(pe+=+fe.weight,Ie.result=+fe.weight)),Ie.scoreMax=n.options?Number(n.options.totalScore):null,kInteractive.questions.f.showExp(n.userDict,ce[F],fe,n.options);var qe=document.createElement("div");qe.innerHTML=fe.q.replace(/'/g,"&#39;");var Le=qe.textContent,Se=a.question?a.question.replace("[no]",me):"Question "+me;de+=he?"<span style='border-bottom: dotted 1px #aaa;' title='"+Le+"'>"+Se+".</span>  <span style='color:#366c20'>"+a.correct+"</span><br/>":"<span style='border-bottom: dotted 1px #aaa;' title='"+Le+"'>"+Se+".</span>  <span style='color:#7a1818'>"+a.incorrect+"</span><br/>"}n.options&&n.options.visibilityDurationStopAfterSubmit&&e.clock&&(e.clock.destroy&&e.clock.destroy(),e.clock=null),setTimeout((function(){"undefined"!=typeof isKotobee&&"undefined"!=typeof markers&&markers.refreshMarkers()}),100);for(F=0;F<ve.length;F++)ve[F].weighting=Math.round(1e3*n.options.totalScore/ue)/1e3;var De,Te=n.action;n.options.totalScore&&ue&&(De=Math.round(10*n.options.totalScore*pe/ue)/10);var Be="";"ar"==n.options.lang&&(Be=' direction="rtl"');var Re="";if(a.scoreWeight){if(null!=De){var Me="";n.options.passScore&&(De>=n.options.passScore||De==n.options.totalScore?Me+=a.pass:Me+=a.fail),Me&&(Me+=". "),Re+="<h3"+Be+">"+(Me||"")+a.scoreWeight.replace("[score]",De).replace("[total]",n.options.totalScore)+"</h3>"}Re+="<p"+Be+">"+a.score.replace("[correct]",le).replace("[total]",me)+"</p>"}else Re="You scored "+le+" question(s) out of "+me;"selfAnswerReport"==Te&&(Re="<p"+Be+"><strong>"+Re+"</strong></p><p><strong>"+(a.details?a.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+de+"</p>"),"selfAnswer"!=Te&&"selfAnswerReport"!=Te||(kInteractive.alert({content:Re}),re()),("email"==Te||n.options.reportEmail||n.options.emailForm||n.options.serverReports)&&function(){var r="email"==Te||n.options.reportEmail||n.options.emailForm,s="selfAnswer"!=Te&&"selfAnswerReport"!=Te&&"email"!=Te;try{if(!config.kotobee.cloudid)return void(s&&kInteractive.alert({content:i.cloudOnly,title:a.sorry?a.sorry:"Sorry"}))}catch(e){return void(s&&kInteractive.alert({content:i.cloudOnly,title:a.sorry?a.sorry:"Sorry"}))}var o={};o.ans=new Array;for(var c=0,l=0;l<ce.length;l++){var d=ce[l].getElementsByClassName("ans"),u=kInteractive.questions.f.getQClass(ce[l]),p=ce[l].getElementsByClassName("questionTxt"),v=p.length?p[0].textContent:"",m=ce[l].id,h=n.q[l];if("tf"==u||"mcq"==u||"mmcq"==u)for(var f=0;f<d.length;f++)d[f].checked&&o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,index:f,label:d[f].nextSibling.textContent||d[f].nextSibling.data});else if("na"==u)o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,label:d[0].value});else if("sa"==u)o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,label:d[0].value});else if("dd"==u)for(f=0;f<d.length;f++)o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,index:f,label:d[f].textContent,category:kInteractive.hasClass(d[f].parentNode,"dCategory")?d[f].parentNode.children[0].textContent:""});else if("ih"==u){var g=ce[l].querySelector(".ih-container"),k=[];g&&g.answers&&(k=g.answers.map((function(e){return{x:e.x,y:e.y}}))),o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,selected:k})}else if("mt"==u){var y=ce[l].getElementsByClassName("mt-container")[0];if(y&&y.mtSelection)for(var b=y.mtSelection.pairs||[],I=0;I<b.length;I++){var C=b[I];o.ans.push({q:c,id:m,title:v,type:u,weight:h.weight,left:C.left,right:C.right})}}"sp"!=u&&c++}o.id=e.id,o.title=se,n.options.reportLabel&&(o.title=n.options.reportLabel),o.fullScore=De,o.maxScore=n.options.totalScore,o.weightedScore=pe,o.maxWeight=ue,o.score=le,o.total=me,o.correctQuestions=le,o.totalQuestions=me,o.rtl=n.options.rtl;var w={};if(w.recipient=n.address,n.options.reportEmail&&(w.recipient=n.options.reportEmail),n.options.emailForm){var E=e.getElementsByClassName("emailForm");if(E.length){var x=E[0].getElementsByClassName("txtfield");x.length&&(w.recipient=w.recipient?w.recipient+","+x[0].value:x[0].value)}}w.content=JSON.stringify(o),w.mode=config.kotobee.mode,w.cloudid=config.kotobee.cloudid;try{var A=angular.element(document.body).scope();"undefined"!=typeof kotobee&&(w.env=config.kotobee.mode,"library"==config.kotobee.mode&&A.data.book&&(w.bid=A.data.book.id)),w.email=A.data.user.email,w.code=A.data.user.code,w.pwd=A.data.user.pwd}catch(e){}if(r&&w.recipient){var N=t.value;t.value=a.submitting?a.submitting:"Submitting ..",t.setAttribute("disabled","true");var q=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/report/questions";kInteractive.questions.f.sendPost(q,w,(function(e){try{var n=e.target;if(t.value=N,t.removeAttribute("disabled"),4===n.readyState&&200===n.status){if(!s)return;JSON.parse(n.responseText).success?kInteractive.alert({content:a.submitted?a.submitted:"Answers submitted!"}):kInteractive.alert({content:a.errorSubmitting?a.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(e){if(t.value=N,t.setAttribute("value",t.value),t.removeAttribute("disabled"),!s)return;kInteractive.alert({content:a.errorSubmitting?a.errorSubmitting:"An error has occurred while sending answers to the server"})}}))}if(n.options.dateRange&&n.options.dateRangeEnabled&&(w.drange=encodeURI(JSON.stringify(n.options.dateRange))),n.options.reportsubmission&&(w.reportsubmission=n.options.reportsubmission),e.clock&&(w.duration=e.clock.time),"undefined"!=typeof isKotobee){if(n.options.serverReports){q=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"library/questions/add";kInteractive.questions.f.sendPost(q,w,(function(e){try{var t=e.target;if(4===t.readyState&&200===t.status){var n=JSON.parse(t.responseText);if(n.error)if("s_userAlreadySubmitted"==n.error)kInteractive.alert({content:a.errorAlreadySubmitted?a.errorAlreadySubmitted:"Answers have already been submitted previously"});else if("early"==n.error)kInteractive.alert({content:a.questionsExpired});else if("expired"==n.error)kInteractive.alert({content:a.questionsExpired});else{kotobee.popup("An error has occurred. Please contact support if you believe this is a mistake.",{title:"Error Code: "+n.error})}}}catch(e){}}))}if(config.kotobee.ltireporting&&"undefined"!=typeof launchid){w.launchid=launchid;q=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"lti/1.3/report";kInteractive.questions.f.sendPost(q,w)}re()}}(),document[e.id]||(document[e.id]={}),document[e.id].q=[];var Oe=e.getElementsByClassName("ques");for(j=0;j<Oe.length;j++){ge=j,ke=kInteractive.questions.f.getItemOrder(e);n.options.randomize&&(ge="slides"==n.options.displayMode&&ke?Number(ke[j]):Number(Oe[j].getAttribute("data-o"))),document[e.id].q[ge]=[];var Pe=Oe[j].getElementsByClassName("ans");for(F=0;F<Pe.length;F++)kInteractive.hasClass(Pe[F],"txtfield")?document[e.id].q[ge][F]=Pe[F].value:Pe[F].type&&"checkbox"==Pe[F].type.toLowerCase()||Pe[F].type&&"radio"==Pe[F].type.toLowerCase()?document[e.id].q[ge][F]=Pe[F].checked:kInteractive.c.hasClass(Pe[F].parentNode,"dCategory")?document[e.id].q[ge][F]={id:Pe[F].id,category:kInteractive.getChildIndex(Pe[F].parentNode)}:kInteractive.hasClass(Pe[F],"ih-container")&&(document[e.id].q[j][F]=Pe[F].answers||[])}setTimeout((function(){kInteractive.scorm&&kInteractive.scorm.setInteractions(ve),kInteractive.events&&kInteractive.events.add({action:"questionsSubmitted",param:se,elem:e,data:n}),kInteractive.isEditorMode()||n.options.disableAfterAttempts&&kInteractive.isKotobeeUser()&&kInteractive.questions.f.getAttempts(e,(function(t){t||(t=0),t++;var i={label:e.id+"-attempts"};if(n.options.serverReports&&kInteractive.isKotobeeUser()||kotobee.setData(Object.assign(i,{overwrite:1,data:t}),(function(){})),t>=n.options.disableAfterAttempts){kInteractive.c.addClass(e,"disabled");for(var a=e.getElementsByTagName("input"),r=0;r<a.length;r++)a[r].setAttribute("disabled","disabled")}}))}),500),n.options.hideAfterSubmit&&Re&&kInteractive.questions.f.replaceWithError(e,{msg:Re,className:"qSubmitted",tag:"div"})}}}}}}},resize:function(e){var t=kInteractive.readData(e);if(t)for(var n=0;n<t.q.length;n++){var i=t.q[n];"mt"==i.type&&kInteractive.questions.mt.resize(i)}}},kInteractive.threed={preRender:function(e,t){},postRender:function(e,t,n,i){var a=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){t.innerHTML="";var s=t.getAttribute("style");if(r.inter.placeholderPath){var o="undefined"==typeof isKotobee?r.inter.placeholderPath:ph.join(kInteractive.absoluteURL,r.inter.placeholderPath);s+="background-image:url('"+(o=kInteractive.cleanURL(o))+"');"}t.setAttribute("style",s);var c=document.createElement("a");r.inter.includeMsg?(c.innerHTML=kInteractive.escapeHtml(r.inter.msg),c.className="msgBtn ki-btn"):c.className="invisibleBtn ki-btn",a.appendChild(c),"undefined"==typeof isKotobee&&c&&c.addEventListener("click",kInteractive.actionEvent),t.appendChild(a)}},action:function(e,t,n){var i=kInteractive.readData(e);if(i){"inPanel"==i.inter.target?kInteractive.c.addClass(e,"running"):e.innerHTML="";var a=document.createElement("div");if(a.className="loading",e.appendChild(a),"undefined"==typeof THREE){var r,s=document.getElementsByTagName("head")[0],o=s.getElementsByTagName("script");if("undefined"!=typeof isKotobee)r=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for(var c=0;c<o.length;c++)if(o[c].src.indexOf("kotobeeinteractive.js")>=0){r=o[c].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!r)return;var l=document.createElement("script");l.type="text/javascript",l.src=r,l.onload=d,l.onreadystatechange=function(){"complete"==this.readyState&&d()},s.appendChild(l)}else d()}function d(){var t,n=e;if("inPanel"==i.inter.target){var r={class:"threed",cb:function(e){var t=document.createElement("div");t.className="container",e.appendChild(t),s(t)},closed:function(){kInteractive.c.removeClass(e,"running")}};kInteractive.openFrame(r)}else s(n);function s(n){if(setTimeout((function(){if(kInteractive.scorm){var t={};t.id=kInteractive.getScormId("_3D",i.name?i.name:"Model"),t.description="Opened 3D model: "+(i.name?i.name:"No name"),t.learnerResponses="Viewed",t.type="other",t.timestamp=new Date,kInteractive.scorm.setInteractions([t])}kInteractive.events&&kInteractive.events.add({action:"3dModelViewed",param:i.name?i.name:"No name",elem:e,data:i})}),800),t&&cancelAnimationFrame(t),"fbx"!==i.type){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var r;r=new THREE.WebGLRenderer({precision:"highp"});var s=n.offsetWidth,o=n.offsetHeight,c=new THREE.PerspectiveCamera(i.camera.viewAngle,s/o,i.camera.near,i.camera.far),l=new THREE.Scene;null!=i.scene.bgColor&&r.setClearColor(i.scene.bgColor,1),l.add(c),c.position.x=i.camera.x,c.position.y=i.camera.y,c.position.z=i.camera.z,r.setSize(s,o),i.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:i.scene.floorColor?i.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,l.add(floor));var d=new THREE.LoadingManager;d.onProgress=function(e,t,n){},function e(t){if(!(t>=i.objects.length)){var s=i.objects[t],o="undefined"==typeof isKotobee?s.path:ph.join(kInteractive.absoluteURL,s.path);o=kInteractive.cleanURL(o),new OBJLoader(d).load(o,(function(i){a&&a.parentNode&&a.parentNode.removeChild(a),r.domElement.parentNode||n.appendChild(r.domElement),i.position.set(s.x,s.y,s.z),i.traverse((function(n){if(n instanceof THREE.Mesh){var a=n==i.children[i.children.length-1];if(s.textPath){var r=new THREE.ImageLoader(d),o="undefined"==typeof isKotobee?s.textPath:ph.join(kInteractive.absoluteURL,s.textPath);r.load(o,(function(r){var s=new THREE.Texture;s.image=r,s.needsUpdate=!0,n.material.map=s,a&&l.add(i),e(++t)}),(function(){}),(function(e){}))}else a&&l.add(i),e(++t)}}))}),(function(e){if(e.lengthComputable)e.loaded,e.total}),(function(e){}))}}(0),new OrbitControls(c,r.domElement).target=new THREE.Vector3(0,0,0),kInteractive.threed.addLight(l,i);var u=new THREE.Clock;!function e(){try{r.render(l,c)}catch(e){return}u.getDelta(),t=requestAnimFrame(e)}()}else"inPanel"===i.inter.target?setTimeout((function(){kInteractive.threed.fbxLoader(n,i)}),500):kInteractive.threed.fbxLoader(n,i)}}},get webglAvailable(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},alert:function(){kotobee.popup(translit.get("webglNotAvailable"),{title:"WebGl",okBtn:translit.get("ok"),raw:!1,noBackdrop:!1,cb:function(){}})},addLight:function(e,t){t.lights.forEach((function(t){if("pointLight"==t.type){var n=new THREE.PointLight(t.color);n.position.set(t.x,t.y,t.z),e.add(n)}else if("directionalLight"==t.type){var i=new THREE.DirectionalLight(t.color,t.intensity);i.position.set(t.x,t.y,t.z),e.add(i)}else if("hemisphereLight"==t.type){var a=new THREE.HemisphereLight(t.sky,t.ground,t.intensity);a.position.set(t.x,t.y,t.z),e.add(a)}else if("spotLight"==t.type){var r=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);r.position.set(t.x,t.y,t.z),e.add(r)}else if("ambientLight"==t.type){var s=new THREE.AmbientLight(t.color);e.add(s)}else if("areaLight"==t.type){var o=new THREE.RectAreaLight(t.color,t.intensity);e.add(o)}}))},fbxLoader:function(e,t){if(!kInteractive.threed.webglAvailable)return kInteractive.threed.alert();var n,i,a;"inPanel"===t.inter.target?(i=e.getBoundingClientRect().width,a=e.getBoundingClientRect().height):(i=+t.scene.width,a=+t.scene.height);var r=t.scene.bgColor,s=new THREE.Scene,o=new THREE.PerspectiveCamera(+t.camera.viewAngle,i/a,t.camera.near,+t.camera.far);o.position.setX(+t.camera.x),o.position.setY(+t.camera.y),o.position.setZ(+t.camera.z);var c=new THREE.Clock;kInteractive.threed.addLight(s,t);var l=function(){var e;return(e=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(i,a),e.shadowMap.enabled=!0,e.setClearColor(r,1),e}();e.appendChild(l.domElement);var d=new OrbitControls(o,l.domElement);d.target.set(0,0,0),d.update();var u=new FBXLoader,p=function(e){if(Array.isArray(e.objects)&&e.objects.length){var t=e.objects[0],n="undefined"==typeof isKotobee?t.path:ph.join(kInteractive.absoluteURL,t.path);return kInteractive.cleanURL(n)}return!1}(t);p&&(u.load(p,(function(e){n=new THREE.AnimationMixer(e),Array.isArray(e.animations)&&e.animations.length&&n.clipAction(e.animations[0]).play(),e.traverse((function(e){if(e.isMesh){e.castShadow=!0,e.receiveShadow=!0;var n=document.getElementsByClassName(t.classname)[0];if(n)[].slice.call(n.getElementsByClassName("loading")).forEach((function(e){kInteractive.c.removeClass(e,"loading")}))}})),s.add(e)})),function e(){requestAnimationFrame(e);var t=c.getDelta();n&&n.update(t),l.render(s,o)}())}},kInteractive.video={preRender:function(e,t){},postRender:function(e,t,n){var i=e.createDocumentFragment(),a=kInteractive.readData(t);if(a){var r="";if(a.splash&&(r="undefined"==typeof isKotobee?a.splash:ph.join(kInteractive.absoluteURL,a.splash)),r){t.style.backgroundImage=null;var s=t.style.cssText;r=kInteractive.cleanURL(r),t.setAttribute("style","background-image:url('"+r+"');"+s)}t.setAttribute("id","ki-video-"+n),t.innerHTML="";var o=document.createElement("div");o.setAttribute("id","ki-video-"+n+"-container"),o.className="container";var c=document.createElement("div");a.style&&kInteractive.c.addClass(c,a.style);var l=document.createElement("a");l.className="playBtn ki-btn",l.appendChild(document.createElement("span")),"undefined"==typeof isKotobee&&l.addEventListener("click",kInteractive.actionEvent),i.appendChild(l),i.appendChild(o),c.appendChild(i),t.appendChild(c);var d=function(){for(var e=[],t=document.getElementsByClassName("kInteractive"),n=0;n<t.length;n++){if(-1!==t[n].className.indexOf("video"))if(kInteractive.readData(t[n]).autoplay){e.push(t[n]);break}}return e.length?e[0]:null}();a.autoplay&&d&&t===d&&kInteractive.action(d)}},action:function(e){var t=kInteractive.readData(e);if(t){if(t.popup&&"kInteractiveFrame"!=e.parentNode.id){var n={pos:"side",aspectRatio:"16:9",cb:function(t){var n=document.createElement("div");n.innerHTML=e.outerHTML;var i=n.children[0];i.style.width="100%",i.style.height="100%",i.style.margin="0",i.style.position="absolute",i.style.left=0,i.style.top=0,kInteractive.c.removeClass(i,"kbHidden"),t.appendChild(i);var a=e.id.split("ki-video-")[1];kInteractive.postRender(document,i,a),setTimeout((function(){kInteractive.action(i)}),100)}};return kInteractive.openFrame(n)}var i=e.getAttribute("id")+"-container",a=e.getElementsByClassName("playBtn")[0];if(!(a.className.indexOf("loading")>=0)){if(kInteractive.stopCurrentMedia(),a.className="playBtn ki-btn loading",t.autoplay&&(a.className="playBtn ki-btn hide"),kInteractive.scorm){var r={};r.id=kInteractive.getScormId(e.getAttribute("id"),t.src),r.description="Played video: "+t.src,r.type="other",r.learnerResponses="Played",r.objective=t.options?t.options.objective:null,r.timestamp=new Date,kInteractive.scorm.setInteractions([r])}if(kInteractive.events&&kInteractive.events.add({action:"videoPlayed",param:t.src,elem:e,data:t}),"file"==t.type){u("undefined"==typeof isKotobee?t.video:ph.join(kInteractive.absoluteURL,t.video))}else{var s,o=new URL(t.src);if(o.origin.includes("youtube.com")||o.origin.includes("youtu.be")){if(!(s=o.origin.includes("youtube.com")?o.searchParams.get("v"):o.pathname.split("/")[1]))return;if(window&&window.iBooks)return setTimeout((function(){a.className="playBtn ki-btn"}),1500),void(window.location.href=t.src);var c={videoId:s,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+t.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){a.className="playBtn ki-btn hide",new YT.Player(i,c)}}else"ready"==kInteractive.youTubeStatus&&(a.className="playBtn ki-btn hide",new YT.Player(i,c));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var l=document.createElement("script");l.src="https://www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(l,d),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){a.className="playBtn ki-btn hide",new YT.Player(i,c)}}}else u(t.src)}kInteractive.currentVideo=e,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}}function u(n){var i,r=document.createElement("video");r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("src",kInteractive.cleanURL(n)),r.setAttribute("autoplay","true"),r.setAttribute("disablePictureInPicture","true"),r.setAttribute("data-tap-disabled","false"),0!=n.indexOf("http://")&&0!=n.indexOf("https://")||(i=!0),i&&r.setAttribute("crossorigin","anonymous");var s=!1;try{s=navigator.userAgent.toLowerCase().indexOf("android")>-1}catch(e){}s||r.setAttribute("type","video/mp4"),r.setAttribute("webkit-playsinline","true"),r.setAttribute("controls","true");var o="";t.splash&&(o="undefined"==typeof isKotobee?t.splash:ph.join(kInteractive.absoluteURL,t.splash)),o&&r.setAttribute("poster",kInteractive.cleanURL(o)),r.className="ki-noHighlight",t.hideDownloadBtn&&(r.className+=" hideDownloadBtn",r.setAttribute("controlsList","nodownload")),r.innerHTML="Your browser doesn't support HTML5 video.",i&&(r.crossOrigin="anonymous"),r.oncanplay=function(){kInteractive.currentVideo==e&&(a.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+n}))},r.addEventListener("error",(function(e){e.target.error&&kInteractive.stopCurrentMedia()})),r.addEventListener("webkitfullscreenchange",(function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t}));var c=e.getElementsByClassName("container")[0];c.setAttribute("data-tap-disabled","true"),c.appendChild(r)}},resize:function(e){var t=kInteractive.readData(e);t&&(kInteractive.checkResponsiveFloat(t,e),t.maintainRatio&&"px"==t.widthUnit&&t.height&&t.width&&"absolute"!=e.style.position&&(e.style.height=e.offsetWidth*(t.height/t.width)+"px"))}},kInteractive.widget={preRender:function(e,t){},postRender:function(e,t,n,i){i||(i={});var a=e.createDocumentFragment(),r=kInteractive.readData(t);if(r){var s=r.name,o=(r.src,r.width),c=r.height;if("page"==r.mode){if(t.children.length)return;var l=document.createElement("div");l.className="cover",a.appendChild(l),r.interaction&&(l.style.pointerEvents="none");var d=document.createElement("div");d.className="iframeContainer";var u,p=document.createElement("iframe");if(p.setAttribute("nwdisable","true"),p.setAttribute("nwfaketop","true"),"undefined"!=typeof desktop&&desktop&&(u=!0),"undefined"!=typeof isReaderApp&&isReaderApp&&(u=!0),u&&p.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),p.setAttribute("width",t.style.width?t.style.width:o+r.widthUnit),p.setAttribute("height",t.style.height?t.style.height:c+"px"),p.src=kInteractive.getWidgetUrl(r,i),"undefined"!=typeof kotobee&&-1!==p.src.indexOf(".amazonaws.com")){var v=document.createElement("a");v.href=p.src,p.addEventListener("load",(function(e){e.target.contentWindow.postMessage({user:{name:kotobee.user.name?kotobee.user.name:"",email:kotobee.user.email?kotobee.user.email:"",loggedIn:kotobee.user.loggedIn},book:kotobee.book.meta.dc.identifier,chapter:kotobee.currentChapter.url.split("EPUB/xhtml/")[1]},v.protocol+"//"+v.hostname)}))}d.appendChild(p),a.appendChild(d);var m=t.style.width,h=t.style.height;m.indexOf("px")>=0&&(r.widthUnit="px"),m.indexOf("%")>=0&&(r.widthUnit="%");try{r.widthUnit?r.width=Number(m.split(r.widthUnit)[0]):r.width=Number(m)}catch(e){r.width=Number(m)}try{r.height=Number(h.split("px")[0])}catch(e){r.height=Number(h)}kInteractive.writeData(t,r)}else{if(!t.children.length&&!t.innerHTML.trim()){var f=document.createElement("img");f.src=kInteractive.cleanURL(kInteractive.getWidgetHome(r,i)+"/"+s+"/Icon.png?c="+Math.round(9999*Math.random())),f.className="wdgtIcon",a.appendChild(f)}"undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent)}t.appendChild(a)}},action:function(e){var t=kInteractive.readData(e);if(t){var n,i=kInteractive.getWidgetUrl(t),a=document.createElement("iframe");a.setAttribute("nwdisable","true"),a.setAttribute("nwfaketop","true"),"undefined"!=typeof desktop&&desktop&&(n=!0),"undefined"!=typeof isReaderApp&&isReaderApp&&(n=!0),n&&a.setAttribute("sandbox","allow-same-origin allow-scripts allow-forms allow-modals allow-popups allow-top-navigation"),t.cb=function(e){a.src=i,e.appendChild(a)},t.cb1="yes",t.closed=function(){},t.responsive&&(t.width=t.height=null),kInteractive.openFrame(t),kInteractive.tinCan({verb:"opened",activity:"Widget: "+t.name}),setTimeout((function(){if(kInteractive.scorm){var n={};n.id=kInteractive.getScormId("widget",t.name),n.description="Opened popup widget: "+t.name,n.learnerResponses="Opened",n.type="other",n.timestamp=new Date,kInteractive.scorm.setInteractions([n])}kInteractive.events&&kInteractive.events.add({action:"popupWidgetOpened",param:t.name,elem:e,data:t})}),800)}},resize:function(e){var t=kInteractive.readData(e);if(t&&"page"==t.mode&&"px"==t.widthUnit){var n=t.width,i=t.height,a=e.parentNode;if(a)if(n>a.offsetWidth){var r=a.offsetWidth/n,s=e.children.length-1;e.children[s].style.transform=e.children[s].style.webkitTransform=e.children[s].style.mozTransform="scale("+r+")",e.children[s].style.transformOrigin=e.children[s].style.webkitTransformOrigin=e.children[s].style.mozTransformOrigin="0 0",e.style.maxWidth=e.style.width,e.style.height=Math.round(i*r)+"px"}else{for(s=0;s<e.children.length;s++)e.children[s].style.transform=e.children[s].style.webkitTransform=e.children[s].style.mozTransform=e.children[s].style.transformOrigin=e.children[s].style.webkitTransformOrigin=e.children[s].style.mozTransformOrigin=null;e.style.maxWidth=null,e.style.height=i+"px"}}}},kInteractive.questions.dd={create:function(e){var t=e.qElem,n=e.qData,i=(e.qsData,e.k),a=e.i,r=(e.elem,e.options),s=document.createElement("div");s.className="categoryContainer";for(var o=[],c=0;c<n.k.length;c++){var l=n.k[c],d=c,u=document.createElement("div");u.className="dCategory ki-noHighlight ki-dd-category-"+d;var p=document.createElement("div");p.innerHTML=l.category.name,p.className="qTitle",u.appendChild(p);var v=document.createElement("div");v.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),v.setAttribute("ondrop","kInteractive.questions.dd.drop(event)"),v.setAttribute("showplaceholder","true"),v.className="ki-dragPane",u.appendChild(v);for(var m=0;m<l.category.answers.length;m++)o.push(l.category.answers[m]);s.appendChild(u)}t.appendChild(s);var h=document.createElement("div");h.className="ki-dd-clearfix",t.appendChild(h);var f=document.createElement("div");f.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),f.setAttribute("ondrop","kInteractive.questions.dd.drop(event)"),f.className="ki-dd-answers ki-noHighlight";var g=[];for(c=0;c<o.length;c++){d=c;var k=o[c],y=document.createElement("div"),b="ki-dd-"+i+"-"+a+"-"+d;y.id=b,y.innerHTML="<span></span>",y.children[0].innerText=k.t,kInteractive.questions.f.addMedia(k,y,r),y.className="ki-draggable ans ki-noHighlight",y.draggable=!0,y.setAttribute("ondragover","kInteractive.questions.dd.allowDrop(event)"),y.setAttribute("ondragstart","kInteractive.drag(event);"),y.setAttribute("ondragend","kInteractive.questions.dd.removePlaceholder(event)"),y.setAttribute("onmousedown","event.stopPropagation();"),y.setAttribute("ontouchstart","event.stopPropagation();"),kInteractive.questions.f.manualDrag.isIOS()&&(y.setAttribute("ontouchstart","kInteractive.questions.f.manualDrag.dragStart(event);"),y.setAttribute("ontouchmove","kInteractive.questions.f.manualDrag.dragMove(event);"),document.addEventListener("touchend",(function(){kInteractive.questions.f.manualDrag.isDown=!1}))),"undefined"==typeof isKotobee&&y.addEventListener("dragend",kInteractive.actionEvent),g.push(y)}kInteractive.shuffleArray(g);for(c=0;c<g.length;c++)f.appendChild(g[c]);return t.appendChild(f),t},removePlaceholder:function(e){var t=e.target,n=kInteractive.getParentInteractiveElem(t).getElementsByClassName("ki-dd-placeholder")[0];n&&n.parentNode.removeChild(n)},drop:function(e){var t=e.target,n=e.view.dragged;if(kInteractive.getParentInteractiveElem(t,"ques")==kInteractive.getParentInteractiveElem(n,"ques")&&("span"==t.nodeName.toLowerCase()&&(t=t.parentNode),e.preventDefault&&e.preventDefault(),t.hasAttribute("ondragover"))){for(;!kInteractive.hasClass(t,"ki-dragPane")&&!kInteractive.hasClass(t,"ki-dd-answers")&&!kInteractive.hasClass(t,"kInteractive");)t=t.parentNode;if(!kInteractive.hasClass(t,"kInteractive")){var i=this.getClosestElem(t,e);i?t.insertBefore(n,i):t.appendChild(n)}}},getClosestElem:function(e,t){for(var n=t.clientY,i=Array.prototype.slice.call(e.children),a=0;a<i.length;a++){var r=i[a].getBoundingClientRect();if(n<r.top+r.height/2)return i[a]}},allowDrop:function(e){var t=e.target,n=kInteractive.getParentInteractiveElem(e.target);if("true"==t.getAttribute("showplaceholder")){var i=n.getElementsByClassName("ki-dd-placeholder")[0];i||((i=document.createElement("div")).className="ki-dd-placeholder",t.appendChild(i));var a={target:t,clientY:e.clientY,view:{dragged:i}};this.drop(a)}e.preventDefault()}},kInteractive.questions.fib={create:function(e){var t=e.qElem,n=e.qData,i=e.k,a=e.i,r=e.elem,s=document.createElement("div");s.className="ki-fib-wrap";var o=Array.isArray(n.blanks)?n.blanks:[],c=r&&r.id?r.id:null,l=c&&document[c]&&document[c].preserve&&document[c].q&&document[c].q[a]?document[c].q[a]:null,d=n.sentence||n.leadText||"",u=document.createElement("div");u.innerHTML=d;var p=u.querySelectorAll(".fib-blank, .fib-blank-hl"),v=[];if(p.length>0){for(var m=0;m<p.length;m++){var h=p[m],f=h.getAttribute("data-blank-id");o.find((function(e){return e.id===f}));(C=document.createElement("input")).type="text",C.className="ki-textfield ans fib-input",C.name="fib-"+i+"-"+a+"-"+m,C.id="ki-fib-"+i+"-"+a+"-"+m,C.setAttribute("data-blank-id",f),null!=l&&(Array.isArray(l)&&null!=l[m]?C.value=l[m]:Array.isArray(l)||null==l[f]||(C.value=l[f])),"undefined"==typeof isKotobee&&(C.addEventListener("keyup",kInteractive.actionEvent),C.addEventListener("change",kInteractive.actionEvent)),v.push(C),h.parentNode.replaceChild(C,h),kInteractive.questions.fib.resizeFibInput(C)}s.appendChild(u)}else{for(var g=n.originalSentence||"",k=document.createDocumentFragment(),y=0,b=o.slice().sort((function(e,t){return e.position-t.position})),I=0;I<b.length;I++){var C,w=b[I];if(w.position>y){var E=document.createTextNode(g.substring(y,w.position));k.appendChild(E)}(C=document.createElement("input")).type="text",C.className="ki-textfield ans txtfield fib-input",C.name="fib-"+i+"-"+a+"-"+I,C.id="ki-fib-"+i+"-"+a+"-"+I,C.setAttribute("data-blank-id",w.id),C.size=Math.max(w.length,6),null!=l&&(Array.isArray(l)&&null!=l[I]?C.value=l[I]:Array.isArray(l)||null==l[w.id]||(C.value=l[w.id])),"undefined"==typeof isKotobee&&(C.addEventListener("keyup",kInteractive.actionEvent),C.addEventListener("change",kInteractive.actionEvent)),v.push(C),k.appendChild(C),kInteractive.questions.fib.resizeFibInput(C),y=w.position+w.length}if(y<g.length){var x=document.createTextNode(g.substring(y));k.appendChild(x)}s.appendChild(k)}return t.appendChild(s),t._fibInputs=v,t},get:function(e){for(var t=e.qElem,n={},i=t._fibInputs||t.querySelectorAll("input.fib-input"),a=0;a<i.length;a++){var r=i[a];n[r.getAttribute("data-blank-id")]=r.value||""}return n},grade:function(e){for(var t=e.qElem,n=e.qData,i=e.qsData,a=Array.isArray(n.blanks)?n.blanks:[],r=!!n.caseSensitive,s=this.get(e),o=0,c=a.length,l=t._fibInputs||t.querySelectorAll("input.fib-input"),d={},u=0;u<l.length;u++){d[(v=l[u]).getAttribute("data-blank-id")]=v}for(var p=0;p<a.length;p++){var v,m=a[p],h=(s[m.id]||"").trim(),f=(m.word||"").trim(),g=!1;(g=r?h===f:h.toLowerCase()===f.toLowerCase())&&o++,(v=d[m.id])&&i.options.highlightCorrect&&(v.classList.toggle("fib-correct",g),v.classList.toggle("fib-incorrect",!g))}return{correct:o,total:c,score:c>0?o/c:0}},resizeFibInput:function(e){if(e&&!e._fibSized){e._fibSized=!0;var t=Math.max(parseInt(e.getAttribute("size")||"0",10)||0,6);n(),e.addEventListener("input",n),e.addEventListener("change",n),e.addEventListener("keyup",n),e.addEventListener("paste",(function(){return setTimeout(n,0)}))}function n(){var n=Math.max((e.value||"").length+1,t),i=Math.min(n,30)+1;e.style.setProperty("width","".concat(i,"ch"),"important")}}},kInteractive.questions.ih={create:function(e){var t=e.qElem,n=e.qData,i=e.qsData,a=e.k,r=e.i,s=document.createElement("a");if(s.className="ih-container ki-a ans",s.id="ki-ih-"+a+"-"+r,s.dataset.qid=n.id,s.style.position="relative",s.style.display="inline-block",n.ihImg&&n.ihImg.path){var o=document.createElement("img");o.src=n.ihImg.path,o.className="ih-image",o.style.display="block",o.style.maxWidth="100%",s.appendChild(o),o.onload=function(){s.imgW=o.naturalWidth,s.imgH=o.naturalHeight,n.hotspots&&!n._normalized&&(n.hotspots=n.hotspots.map((function(e){return _objectSpread(_objectSpread({},e),{},{points:e.points.map((function(e){return{x:e.x/s.imgW*100,y:e.y/s.imgH*100}}))})})),n._normalized=!0)}}var c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.classList.add("ih-overlay"),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.pointerEvents="auto",s.appendChild(c),t.appendChild(s),"undefined"==typeof isKotobee&&s.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)}));var l=document.createElement("a"),d=i.userDict;return d||(d={}),l.innerText=d.resetSelection?d.resetSelection:"Reset selection",l.className="ih-reset-btn btn ki-noHighlight",t.appendChild(l),t},markHotspot:function(e,t){e&&e.setAttribute("fill",t?"rgba(0,255,0,0.4)":"rgba(255,0,0,0.4)")},pointInPolygon:function(e,t){for(var n=e.x,i=e.y,a=!1,r=0,s=t.length-1;r<t.length;s=r++){var o=t[r].x,c=t[r].y,l=t[s].x,d=t[s].y;c>i!=d>i&&n<(l-o)*(i-c)/(d-c)+o&&(a=!a)}return a}},kInteractive.questions.mcq={create:function(e){var t=e.qElem,n=e.qData,i=e.qsData,a=e.k,r=e.i,s=e.elem,o=e.options,c=n.c;if(i.options.randomizeAns){for(var l=c.length-1;l>0;l--){var d=Math.floor(Math.random()*(l+1)),u=[c[d],c[l]];c[l]=u[0],c[d]=u[1]}kInteractive.writeData(s,i)}i.options.inlineChoices&&kInteractive.c.addClass(t,"qInlineChoices"),i.options.toggleChoices&&kInteractive.c.addClass(t,"qToggleChoices");for(var p=0;p<c.length;p++){var v="ki-mcq-"+a+"-"+r+"-"+p,m=document.createElement("input");m.id=v,"mmcq"==n.type?(m.name="name",m.type="checkbox"):(m.name="mcq-"+a+"-"+r,m.type="radio"),m.className="ki-inputbox ans","undefined"==typeof isKotobee&&m.addEventListener("click",kInteractive.actionEvent);var h=document.createElement("label");h.htmlFor=v,h.innerHTML=" "+kInteractive.escapeHtml(c[p].t),h.className="ki-noHighlight",kInteractive.questions.f.addMedia(c[p],h,o),kInteractive.c.hasClass(s,"parsed")&&kInteractive.c.addClass(h,"parsed");var f=document.createElement("div");f.className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[r]&&(m.checked=document[item.id].q[r][p],i.options&&i.options.highlightCorrect&&n.c[p].a&&kInteractive.c.addClass(f,"correct")),f.appendChild(m),f.appendChild(h),t.appendChild(f)}return t}},kInteractive.questions.mt={create:function(e){var t=e.qElem,n=e.qData,i=e.qsData,a=e.k,r=e.i,s=document.createElement("div");s.className="mt-container qMatching",s.id="mt-"+a+"-"+r,s.mtSelection={first:null,pairs:[]},t.mtSelection=s.mtSelection,t.classList.add("question"),t.classList.add("ki-noHighlight");var o=kInteractive.shuffleArray(n.left.slice()),c=kInteractive.shuffleArray(n.right);window.innerWidth<720&&t.classList.add("isMobile");var l=document.createElement("div");l.className="mt-desktop";var d=document.createElement("div");d.className="mt-left",o.forEach((function(e,t){var n="ki-mt-left-"+a+"-"+r+"-"+t,s=document.createElement("a");s.className="mt-left-item ki-a",s.id=n,s.textContent=e.txt,s.href="",s.setAttribute("data-ki-action","action"),s.draggable=!0,s.setAttribute("ondragstart","kInteractive.drag(event);"),s.setAttribute("ondragend","kInteractive.questions.mt.removePlaceholder(event)"),s.setAttribute("onmousedown","event.stopPropagation();"),s.setAttribute("ontouchstart","event.stopPropagation();"),s.setAttribute("data-ki-index",e._kiIndex),s.setAttribute("ondragover","kInteractive.questions.mt.allowDrop(event)"),s.setAttribute("ondrop","kInteractive.questions.mt.drop(event)"),s.setAttribute("data-ki-index",e._kiIndex),kInteractive.questions.f.addMedia(e,s,i.options),"undefined"==typeof isKotobee&&s.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)})),d.appendChild(s)}));var u=document.createElement("div");u.className="mt-right",c.forEach((function(e,t){var n="ki-mt-right-"+a+"-"+r+"-"+t,s=document.createElement("a");s.className="mt-right-item ki-a ans",s.id=n,s.textContent=e.txt,s.href="",s.setAttribute("data-ki-action","action"),kInteractive.questions.f.addMedia(e,s,i.options),s.setAttribute("ondragover","kInteractive.questions.mt.allowDrop(event)"),s.setAttribute("ondrop","kInteractive.questions.mt.drop(event)"),s.setAttribute("data-ki-index",e._kiIndex),s.draggable=!0,s.setAttribute("ondragstart","kInteractive.drag(event);"),s.setAttribute("ondragend","kInteractive.questions.mt.removePlaceholder(event)"),s.setAttribute("onmousedown","event.stopPropagation();"),s.setAttribute("ontouchstart","event.stopPropagation();"),s.setAttribute("data-ki-index",e._kiIndex),"undefined"==typeof isKotobee&&s.addEventListener("click",(function(e){e.preventDefault(),kInteractive.actionEvent(e)})),u.appendChild(s)}));var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.classList.add("mt-lines"),p.setAttribute("xmlns","http://www.w3.org/2000/svg"),p.style.position="absolute",p.style.top="0",p.style.left="0",p.style.width="100%",p.style.height="100%",p.style.pointerEvents="none",l.style.position="relative",l.appendChild(d),l.appendChild(p),l.appendChild(u);var v=document.createElement("div");return v.className="mt-mobile",o.forEach((function(t,n){var i=document.createElement("div");i.className="mt-mobile-item";var o=document.createElement("div");o.className="mt-left-label",o.textContent=t.txt;var l=document.createElement("div");l.className="select-wrapper";var d=document.createElement("select");d.className="mt-mobile-select ki-textfield ",d.setAttribute("data-left",t.txt);var u=document.createElement("option");u.value="default";var p=e.qsData.userDict;u.textContent=p&&p.selectMatch?p.selectMatch:"Select a match",d.appendChild(u),c.forEach((function(e,t){var n=document.createElement("option");n.id="ki-mt-right-"+a+"-"+r+"-"+t,n.value=e.txt,n.textContent=e.txt,n.className="ans",d.appendChild(n)})),"undefined"==typeof isKotobee&&d.addEventListener("change",(function(e){var t=s,n=t.mtSelection||(t.mtSelection={pairs:[]}),i=d.getAttribute("data-left"),a=d.value;n.pairs=n.pairs.filter((function(e){return e.left!==i})),a&&n.pairs.push({left:i,right:a,leftId:null,rightId:null});var r=kInteractive.helpers.persister.instances[t.id];r&&r.handleChange&&r.handleChange()}));var m=document.createElement("span");m.className="arrow",l.appendChild(d),l.appendChild(m),i.appendChild(o),i.appendChild(l),v.appendChild(i)})),s.appendChild(l),s.appendChild(v),t.appendChild(s),t},redrawLines:function(e){var t=e.querySelector("svg.mt-lines");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);for(var n=e.mtSelection?e.mtSelection.pairs:[],i=0;i<n.length;i++){var a=n[i],r=document.getElementById(a.leftId),s=document.getElementById(a.rightId);if(r&&s){var o=t.getBoundingClientRect(),c=r.getBoundingClientRect(),l=s.getBoundingClientRect(),d=c.right-o.left,u=c.top+c.height/2-o.top,p=l.left-o.left,v=l.top+l.height/2-o.top,m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",d),m.setAttribute("y1",u),m.setAttribute("x2",p),m.setAttribute("y2",v),m.setAttribute("stroke","#3a6"),m.setAttribute("stroke-width","2"),t.appendChild(m)}}}},resize:function(e){var t=this,n=window.innerWidth<720,i=document.getElementById(e.id);if(kInteractive.hasClass(i,"isMobile")&&!n){i.classList.remove("isMobile");i.querySelector(".mt-container");i.querySelectorAll(".mt-container").forEach((function(e){e.mtSelection=e.mtSelection||{first:null,pairs:[]},t.redrawLines(e)}))}!kInteractive.hasClass(i,"isMobile")&&n&&(i.classList.add("isMobile"),i.querySelectorAll(".mt-container").forEach((function(e){e.mtSelection=e.mtSelection||{first:null,pairs:[]},e.querySelectorAll(".mt-mobile-select").forEach((function(t){var n=t.getAttribute("data-left"),i=e.mtSelection.pairs.find((function(e){return e.left===n}));t.value=i?i.right:"default"}))})))},allowDrop:function(e){e.preventDefault&&e.preventDefault();var t=e.target;kInteractive.getParentInteractiveElem(e.target);(kInteractive.hasClass(t,"mt-right-item")||kInteractive.hasClass(t,"mt-left-item"))&&t.classList.add("mt-hover")},drop:function(e){e.preventDefault&&e.preventDefault();var t=e.target;t.nodeName&&"span"===t.nodeName.toLowerCase()&&(t=t.parentNode);var n=e.view&&e.view.dragged?e.view.dragged:null;if(n&&kInteractive.getParentInteractiveElem(t,"ques")==kInteractive.getParentInteractiveElem(n,"ques")){var i=t.closest(".mt-container");if(i){i.mtSelection||(i.mtSelection={first:null,pairs:[]});var a=kInteractive.hasClass(n,"mt-left-item")&&kInteractive.hasClass(t,"mt-right-item"),r=kInteractive.hasClass(n,"mt-right-item")&&kInteractive.hasClass(t,"mt-left-item");if(a||r){var s=a?n:t,o=a?t:n;i.mtSelection.pairs=i.mtSelection.pairs.filter((function(e){return e.leftId!==s.id&&e.rightId!==o.id})),i.mtSelection.pairs.push({left:s.textContent.trim(),right:o.textContent.trim(),leftId:s.id,rightId:o.id}),kInteractive.questions.mt.redrawLines(i),kInteractive.helpers.persister.instances[i.id]&&kInteractive.helpers.persister.instances[i.id].handleChange(),t.classList.remove("mt-hover"),kInteractive.questions.mt.removePlaceholder(e)}}}},removePlaceholder:function(e){var t=e.target,n=kInteractive.getParentInteractiveElem(t).getElementsByClassName("ki-dd-placeholder")[0];n&&n.parentNode.removeChild(n)}},kInteractive.questions.na={create:function(e){var t=e.qElem,n=e.qData,i=e.k,a=e.i,r=document.createElement("input");return r.id="ki-na-"+i+"-"+a,r.name="na-"+i+"-"+a,r.type="number",r.className="ki-textfield ans txtfield",r.inputMode="decimal",r.step=null!=n.step?String(n.step):"any",null!=n.min&&(r.min=String(n.min)),null!=n.max&&(r.max=String(n.max)),n.placeholder&&(r.placeholder=n.placeholder),"undefined"==typeof isKotobee&&(r.addEventListener("keyup",kInteractive.actionEvent),r.addEventListener("change",kInteractive.actionEvent)),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[a]&&(r.value=document[item.id].q[a]),t.appendChild(r),t}},kInteractive.questions.ord={create:function(e){var t=e.qElem,n=e.qData||{},i=e.qsData||{options:{}},a=e.options||{},r=e.k,s=e.i,o=n&&n.items,c=n&&n.k,l=n&&n.choices,d=[];Array.isArray(o)?d=o:Array.isArray(c)?d=c.map((function(e){return{t:e}})):Array.isArray(l)?d=l.map((function(e){return{t:e}})):o&&"object"===_typeof(o)&&Array.isArray(o.list)&&(d=o.list),!Array.isArray(d)||d.length;var u=document.createElement("div");u.id="kiOrdContainer",u.className="ki-ord-answers ki-noHighlight ans",u.setAttribute("data-qid",t.id),u.setAttribute("contenteditable","false"),u.setAttribute("onselectstart","return false;"),u.setAttribute("ondragover","kInteractive.questions.ord.onDragOver(event)"),u.setAttribute("ondrop","kInteractive.questions.ord.onDrop(event)"),1===n.horizontal?u.classList.add("ki-ord-horizontal"):u.classList.add("ki-ord-vertical");var p=d.map((function(e,n){var i=document.createElement("div");return i.id=e&&e.id?e.id:"ki-ord-"+r+"-"+s+"-"+n,i.className="ki-draggable ans ki-noHighlight ki-ord-item",i.classList.add("ord-block"),i.setAttribute("data-qid",t.id),i.setAttribute("contenteditable","false"),i.setAttribute("draggable","true"),i.setAttribute("ondragstart","kInteractive.questions.ord.onDragStart(event)"),i.setAttribute("ondragend","kInteractive.questions.ord.onDragEnd(event)"),i.setAttribute("onmousedown","event.stopPropagation();"),i.setAttribute("ontouchstart","event.stopPropagation();"),i.innerHTML="<span></span>",i.children[0].innerText=e&&e.t?e.t:"Item "+(n+1),kInteractive.questions.f&&kInteractive.questions.f.addMedia&&kInteractive.questions.f.addMedia(e,i,a),kInteractive.questions.f&&kInteractive.questions.f.manualDrag&&kInteractive.questions.f.manualDrag.isIOS()&&(i.setAttribute("ontouchstart","kInteractive.questions.f.manualDrag.dragStart(event)"),i.setAttribute("ontouchmove","kInteractive.questions.f.manualDrag.dragMove(event)"),document.addEventListener("touchend",(function(){kInteractive.questions.f.manualDrag.isDown=!1}))),i}));if(i.options&&"function"==typeof kInteractive.shuffleArray){var v=kInteractive.shuffleArray(p);Array.isArray(v)&&(p=v)}return p.forEach((function(e){u.appendChild(e)})),t.appendChild(u),t},_getInsertRef:function(e,t,n,i,a){for(var r=Array.prototype.slice.call(e.querySelectorAll(".ki-ord-item, .ord-item")).filter((function(e){return e!==a})),s=null,o=-1/0,c=0;c<r.length;c++){var l=r[c].getBoundingClientRect(),d=i?t-(l.left+l.width/2):n-(l.top+l.height/2);d<0&&d>o&&(o=d,s=r[c])}return s},clearGaps:function(e){var t=e.classList.contains("ki-ord-horizontal"),n=e.querySelector('[data-ord-gap="1"]');n&&(t?(void 0!==n.dataset.prevMarginLeft&&(n.style.marginLeft=n.dataset.prevMarginLeft),delete n.dataset.prevMarginLeft):(void 0!==n.dataset.prevMarginTop&&(n.style.marginTop=n.dataset.prevMarginTop),delete n.dataset.prevMarginTop),n.removeAttribute("data-ord-gap")),t?void 0!==e.dataset.ordPadRight&&(e.style.paddingRight=e.dataset.ordPadRight,delete e.dataset.ordPadRight):void 0!==e.dataset.ordPadBottom&&(e.style.paddingBottom=e.dataset.ordPadBottom,delete e.dataset.ordPadBottom);var i=e.querySelector(".ki-ord-placeholder, .ki-dd-placeholder");i&&i.parentNode&&i.parentNode.removeChild(i)},onDragStart:function(e){var t=e.currentTarget||e.target;try{if("function"==typeof e.dataTransfer.setDragImage){var n=t.cloneNode(!0);n.style.position="absolute",n.style.top="-9999999px",n.style.left="-9999999px",n.style.opacity="0.7",n.style.pointerEvents="none",n.style.boxShadow="0 5px 15px rgba(0,0,0,0.3)",document.body.appendChild(n),setTimeout((function(){n.parentNode&&document.body.removeChild(n)}),0)}}catch(e){}t.classList.add("dragging"),t.style.opacity="0.5"},onDragEnd:function(e){var t=e.currentTarget&&e.currentTarget.closest(".ki-ord-answers")||document;if(t&&t.querySelector){var n=t.querySelector(".dragging");n&&(n.classList.remove("dragging"),n.style.opacity="1",n.style.pointerEvents="")}if("undefined"==typeof isKotobee&&"function"==typeof kInteractive.actionEvent)try{kInteractive.actionEvent({target:e.currentTarget,type:"dragend"})}catch(e){}},onDragOver:function(e){e.preventDefault();var t=e.currentTarget;if(t.classList.contains("ki-ord-answers")){var n=t.querySelector(".dragging");if(!n)try{var i=e.dataTransfer.getData("text/plain");i&&(n=document.getElementById(i))}catch(e){}if(n&&n.parentNode===t){var a=t.classList.contains("ki-ord-horizontal"),r=kInteractive.questions.ord._getInsertRef(t,e.clientX,e.clientY,a,n);r&&r!==n.nextSibling?t.insertBefore(n,r):r||n===t.lastChild||t.appendChild(n)}}},onDrop:function(e){e.preventDefault();var t=e.currentTarget;if(t.classList.contains("ki-ord-answers")){var n=t.querySelector(".dragging");if(!n)try{var i=e.dataTransfer.getData("text/plain");i&&(n=document.getElementById(i))}catch(e){}if(n&&n.parentNode===t){var a=n.getAttribute("data-qid"),r=t.getAttribute("data-qid");a&&r&&a!==r||(n.classList.remove("dragging"),n.style.opacity="1",n.style.pointerEvents="")}}}},kInteractive.questions.sa={create:function(e){var t=e.qElem,n=e.qData,i=(e.qsData,e.k),a=e.i,r=(e.elem,n.lines?n.lines:1),s=document.createElement(r>1?"textarea":"input"),o="ki-sa-"+i+"-"+a;return s.id=o,s.name="sa-"+i+"-"+a,1==r?s.type="text":s.rows=n.lines?n.lines:1,s.className="ki-textfield ans txtfield","undefined"==typeof isKotobee&&(s.addEventListener("keyup",kInteractive.actionEvent),s.addEventListener("change",kInteractive.actionEvent)),document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[a]&&(s.value=document[item.id].q[a]),t.appendChild(s),t}},kInteractive.questions.sp={create:function(e){var t=e.qElem,n=e.qData;n.topBorder&&kInteractive.c.addClass(t,"topBorder"),n.bottomBorder&&kInteractive.c.addClass(t,"bottomBorder"),kInteractive.c.addClass(t,"separator")}},kInteractive.questions.tf={create:function(e){var t=e.qElem,n=e.qData,i=e.qsData,a=e.k,r=e.i;i.options.inlineChoices&&kInteractive.c.addClass(t,"qInlineChoices"),i.options.toggleChoices&&kInteractive.c.addClass(t,"qToggleChoices");for(var s=0;s<2;s++){var o="ki-tf-"+a+"-"+r+"-"+s,c=document.createElement("input");c.type="radio",c.className="ki-inputbox ans",c.id=o,c.name="tf-"+a+"-"+r,"undefined"==typeof isKotobee&&c.addEventListener("click",kInteractive.actionEvent);var l=document.createElement("label");l.htmlFor=o,n.choice1&&n.choice2?l.innerHTML=kInteractive.escapeHtml(" "+(0==s?n.choice1:n.choice2)):l.innerHTML=" "+(0==s?"True":"False"),l.className="ki-noHighlight";var d=document.createElement("div");d.className="answer",document[item.id]&&document[item.id].preserve&&document[item.id].q&&document[item.id].q[r]&&(c.checked=document[item.id].q[r][s],i.options&&i.options.highlightCorrect&&(0==s&&n.a||1==s&&!n.a)&&kInteractive.c.addClass(d,"correct")),d.appendChild(c),d.appendChild(l),t.appendChild(d)}return t}},kInteractive.questions.f={showExp:function(e,t,n,i){var a;(i||(i={}),n.exp)&&(t.getElementsByClassName("explanation").length||(i.expInPopup?((a=document.createElement("a")).href="",a.className="explanation explanationBtn ki-noHighlight",a.innerHTML=(e.explanation?e.explanation:"Explanation")+" ..",a.addEventListener("click",(function(e){e.preventDefault(),kInteractive.alert({content:n.exp})})),kInteractive.appendAfterDelay(t,a)):((a=document.createElement("p")).className="explanation",a.innerHTML=n.exp,kInteractive.appendAfterDelay(t,a))));if((n.ref||n.reftype)&&!t.getElementsByClassName("reference").length){var r=document.createElement("a");if(r.className="reference",r.innerHTML=e.learnMore?e.learnMore:"Learn more",n.reftype&&"website"!=n.reftype){if("booklocation"==n.reftype&&n.refchapter){var s=ph.relative(bookPath,kInteractive.absoluteURL),o=ph.relative(s,n.refchapter.ahref);n.refanchor&&(o+="#"+n.refanchor),r.setAttribute("href",o),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)}}else r.setAttribute("href",kInteractive.escapeHtml(n.ref)),r.setAttribute("target","_blank"),r.setAttribute("onclick","return false;"),kInteractive.appendAfterDelay(t,r)}if(n.c&&n.c.length){for(var c=t.getElementsByClassName("answer"),l=t.getElementsByClassName("explanation"),d=l.length;d--;)l[d].parentNode.classList.contains("answer")&&l[d].parentNode.removeChild(l[d]);for(d=0;d<n.c.length;d++)i.expForSelection?c[d].getElementsByTagName("input")[0].checked&&kInteractive.questions.f.showExp(e,c[d],n.c[d],i):kInteractive.questions.f.showExp(e,c[d],n.c[d],i)}},getQClass:function(e){var t=e.className;return-1!=t.indexOf("mmcq")?"mmcq":-1!=t.indexOf("mcq")?"mcq":-1!=t.indexOf("tf")?"tf":-1!=t.indexOf("sa")?"sa":-1!=t.indexOf("na")?"na":-1!=t.indexOf("dd")?"dd":-1!=t.indexOf("mt")?"mt":-1!=t.indexOf("ord")?"ord":-1!=t.indexOf("fib")?"fib":void 0},getItemOrder:function(e){var t=e.getAttribute("data-o");return t&&(e.originArray=t.split(",")),e.originArray},createQElem:function(e,t){t||(t={});var n=t.index,i=t.elem,a=(t.rendered,this.getQId(i)),r=kInteractive.questions.f.getItemOrder(i),s=e.q[n];e.options.randomize&&r&&"slides"==e.options.displayMode&&(s=e.q[i.originArray[n]]);var o=document.createElement("div");o.className="ques",s.id&&(o.id=s.id),null!=s.origin&&o.setAttribute("data-o",s.origin),s.q||(s.q="");"undefined"!=typeof config&&config.v;var c=e.options.numbering;"sp"==s.type&&(c=!1);var l="";c&&(l="<span class='no'>"+(t.questionNo?t.questionNo:n)+"</span>"),s.q=s.q.replace(/<html.*<body>([\s\S]*?)<\/body><\/html>/g,"$1");var d="";if(e.options.questionTts){var u=document.createElement("button");u.className="btn ki-btn ki-questions questions-tts ki-noHighlight",u.type="button",u.innerHTML="&#9654;",u.setAttribute("data-text",s.q),d=u.outerHTML}try{o.innerHTML="<div class='questionTxt'>"+d+"<strong>"+l+"</strong> <span class='inner'> "+s.q+"</span></div>"}catch(e){o.innerHTML="<div class='questionTxt'>"+d+"<strong>"+l+"</strong> <span class='inner'>"+kInteractive.escapeHtml(" "+s.q)+"</span></div>"}kInteractive.c.hasClass(i,"parsed")&&kInteractive.c.addClass(o.children[0].getElementsByClassName("inner")[0],"parsed"),kInteractive.questions.f.addMedia(s,o,t),o.classList.add(s.type);var p={qElem:o,qData:s,qsData:e,k:a,i:n,elem:i,options:t};"sp"==s.type?kInteractive.questions.sp.create(p):"sa"==s.type?kInteractive.questions.sa.create(p):"na"==s.type?kInteractive.questions.na.create(p):"mcq"==s.type||"mmcq"==s.type?kInteractive.questions.mcq.create(p):"tf"==s.type?kInteractive.questions.tf.create(p):"dd"==s.type?kInteractive.questions.dd.create(p):"ih"==s.type?kInteractive.questions.ih.create(p):"mt"==s.type?kInteractive.questions.mt.create(p):"ord"==s.type?kInteractive.questions.ord.create(p):"fib"==s.type&&kInteractive.questions.fib.create(p);var v=document.createElement("p");return v.className="separator",o.appendChild(v),document[i.id]&&document[i.id].preserve&&document[i.id].q&&document[i.id].q[n]&&kInteractive.questions.f.showExp(e.userDict,o,s,e.options),o},addMedia:function(e,t,n){var i=n.rendered;if(e.path){var a,r=document.createElement("img");a=i?"undefined"==typeof isKotobee?e.path:ph.join(kInteractive.absoluteURL,e.path):e.path,r.src=kInteractive.cleanURL(a),r.className="qMedia",t.appendChild(r)}if(e.audiopath){var s,o=document.createElement("audio");s=i?"undefined"==typeof isKotobee?e.audiopath:ph.join(kInteractive.absoluteURL,e.audiopath):e.audiopath,o.setAttribute("src",kInteractive.cleanURL(s)),o.controls=!0,o.autoplay=!1,o.className="qMedia",t.appendChild(o)}},getQId:function(e){return Number(e.id.replace("ki-qs-",""))},createSubmitBtn:function(e,t){var n=this.getQId(t),i=document.createElement("input"),a="ki-"+n+"-btn";return i.type="submit",i.value=e.submit?e.submit:"Submit Answers",i.id=a,i.className="btn ki-btn questions-submit","undefined"==typeof isKotobee&&i.addEventListener("click",kInteractive.actionEvent),i},createClearBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.clear?e.clear:"Clear Answers",t.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createAddToNotebookBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.notebook?e.notebook:"Save to Notebook",t.className="btn ki-btn ki-questions questions-notebook","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPreserveBtn:function(e,t,n){var i=this.getQId(t),a=document.createElement("div");a.style.marginBottom="10px";var r=document.createElement("input");function s(e){return e.slice(0,1).toUpperCase()+e.slice(1)}r.type="checkbox",r.name="preserveAnswers",r.className="ki-btn ki-questions questions-preserve",r.id="ki-"+i+"-preserveAnswersBtn",n&&(Object.keys(n).length>0&&Object.keys(n).forEach((function(e){"placement"==e?r.dataset["design"+s(e)]=n[e]:Object.entries(n[e]).forEach((function(t){r.dataset["design"+s(e)+s(t[0])]=t[1]}))})),"undefined"!=typeof isKotobee&&t.addEventListener("change",(function(e){e.target.matches("input.questions-preserve")&&kInteractive.actionEvent(e)}))),document[item.id]&&(r.checked=document[item.id].preserve),a.appendChild(r);var o=document.createElement("label");return o.htmlFor=r.id,o.innerHTML=" "+(e.preserve?e.preserve:"Preserve submitted answers"),o.className="ki-noHighlight",a.appendChild(o),"undefined"==typeof isKotobee&&r.addEventListener("change",kInteractive.actionEvent),a},createNextBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.next?e.next:"Next",t.className="btn ki-btn ki-questions questions-next","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createPrevBtn:function(e){var t=document.createElement("input");return t.type="submit",t.value=e.prev?e.prev:"Previous",t.className="btn ki-btn ki-questions questions-prev","undefined"==typeof isKotobee&&t.addEventListener("click",kInteractive.actionEvent),t},createSeparator:function(){document.createElement("p").className="separator"},createEmailForm:function(e){var t=document.createElement("div");return t.setAttribute("class","emailForm"),function(e,n,i){var a=document.createElement("div");a.className="address",a.innerHTML="<p><strong>"+e+"</strong><em>"+n+"</em></p>";var r=document.createElement("input");r.name=i,r.type="text",r.className="txtfield",a.appendChild(r);var s=document.createElement("p");s.className="separator",a.appendChild(s),t.appendChild(a)}(e.recipientEmail?e.recipientEmail:"Recipient email",e.separateEmails?e.separateEmails:"Separate multiple emails with commas","recipientEmail"),t},showNavBtns:function(e,t,n){var i;n||(n={}),(i=n.isFrag?t.lastElementChild:t.getElementsByClassName("btnContainer")[0]).innerHTML="";var a=kInteractive.questions.f.createPrevBtn(n.userDict);i.appendChild(a),e<=0&&a.classList.add("disabled");var r=kInteractive.questions.f.createNextBtn(n.userDict);if(i.appendChild(r),e==n.qsData.q.length-1){r.classList.add("disabled");var s=kInteractive.questions.f.createSubmitBtn(n.userDict,t);if(s.classList.add("shift"),i.appendChild(s),n.qsData.options.emailForm){var o=kInteractive.questions.f.createEmailForm(n.userDict);o&&i.insertBefore(o,i.firstChild)}}},assess:function(e,t,n){var i={ddInteractionOb:[],mtInteractionOb:[]},a=e.getElementsByClassName("ans"),r=e.querySelector("input.fib-input");if(t&&"fib"===t.type||r&&r.id&&r.id.indexOf("ki-fib-")>=0){var s={qElem:e,qData:t,elem:e.closest(".kInteractive")||e,qsData:n},o=kInteractive.questions.fib.grade(s);a=kInteractive.questions.fib.get(s);return{correct:!!o.total&&o.correct===o.total,learnerResponses:Object.values(a).join("[,]"),correctResponses:Array.isArray(t.blanks)?t.blanks.map((function(e){return e.word||""})).join("[,]"):"",ddInteractionOb:[]}}for(var c=a.length>0,l=0;l<a.length;l++)if(a[l].getAttribute("id").indexOf("ki-tf-")>=0)0==l&&t.a?i.correctResponses=t.choice1:1!=l||t.a||(i.correctResponses=t.choice2),a[l].checked?(i.learnerResponses=l?t.choice2:t.choice1,0!=l||t.a?1==l&&t.a&&(c=!1):c=!1):0==l&&t.a?c=!1:1!=l||t.a||(c=!1),n.options&&n.options.highlightCorrect&&(0==l&&t.a||1==l&&!t.a)&&kInteractive.c.addClass(a[l].parentNode,"correct");else if(a[l].getAttribute("id").indexOf("ki-na-")>=0){var d=a[l].value,u=null==d?"":String(d).trim(),p=""===u?NaN:Number(u);c=!1;var v="";if(t.k&&t.k.length>0)for(var m=0;m<t.k.length;m++){if(null!=(k=t.k[m]?t.k[m].t:null)&&""!==String(k).trim()){var h=Number(String(k).trim());isNaN(h)||(v&&(v+="+"),v+=String(h),isNaN(p)||p!==h||(c=!0))}}i.correctResponses=v,i.learnerResponses=u}else if(a[l].getAttribute("id").indexOf("ki-sa-")>=0){var f=a[l].value.toLowerCase();f&&(f=f.trim()),c=!0;var g="";for(m=0;m<t.k.length;m++){var k;if(!(k=t.k[m].t)){c=!1;break}g&&(g+="+"),g+=k=k.toLowerCase();for(var y=k.split(","),b=!1,I=0;I<y.length;I++)if(f.indexOf(y[I].trim())>=0){b=!0;break}if(!b){c=!1;break}}i.correctResponses=g,i.learnerResponses=f}else if(a[l].getAttribute("id").indexOf("ki-dd-")>=0){kInteractive.c.removeClass(a[l],"incorrect");for(var C,w=a[l].id.split("-")[4],E=0,x=0;x<t.k.length;x++){if(w<(E+=t.k[x].category.answers.length)){C=x;break}}var A=e.getElementsByClassName("dCategory")[C];if((F={}).correct=a[l].innerText+" -> "+A.children[0].innerText,kInteractive.c.hasClass(a[l].parentNode,"ki-dd-answers"))kInteractive.c.addClass(a[l],"incorrect"),c=!1,F.learner=a[l].innerText+" unassigned";else{var N=a[l].parentNode.parentNode,q=N.children[0].innerText,L=kInteractive.getChildIndex(N);F.learner=a[l].innerText+" -> "+q,L!=C&&n.options&&n.options.highlightCorrect&&(c=!1,kInteractive.c.addClass(a[l],"incorrect"))}i.ddInteractionOb.push(F)}else if(a[l].id&&a[l].id.indexOf("ki-ih-")>=0){var S=a[l].answers||[],D=[],T=[];if(t.hotspots)for(var B=0;B<t.hotspots.length;B++)t.hotspots[B].correct&&D.push(t.hotspots[B].id);for(var R=0;R<S.length;R++)for(B=0;B<t.hotspots.length;B++)if(kInteractive.questions.ih.pointInPolygon(S[R],t.hotspots[B].points)){T.push(t.hotspots[B].id);break}T.sort(),D.sort(),c=T.join(",")===D.join(","),i.correctResponses=D.join(", "),i.learnerResponses=T.join(", ")}else if(a[l].getAttribute("id").indexOf("ki-mt-")>=0){kInteractive.c.removeClass(a[l],"incorrect");var M=a[l].closest(".mt-container"),O=M?M.mtSelection:{pairs:[]},P=M.mtSelection&&O.pairs||[],H={};P.length<t.left.length&&(c=!1);for(var j=0;j<t.left.length;j++)H[t.left[j].txt]=t.right[j].txt;for(var z=0;z<P.length;z++){var F,K=P[z];if((F={}).correct=K.left+" -> "+H[K.left],F.learner=K.left+" -> "+K.right,H[K.left]!==K.right&&(c=!1,n.options&&n.options.highlightCorrect)){document.getElementById(K.leftId);var U=document.getElementById(K.rightId);U&&kInteractive.c.addClass(U,"incorrect")}i.mtInteractionOb.push(F)}}else if("ord"===t.type){var _=e.querySelectorAll(".ki-ord-item"),W=Array.from(_).map((function(e){return e.textContent.trim()})),J=(t.items||[]).map((function(e){return(e.t||"").trim()}));i.correctResponses=J,i.learnerResponses=W,c=W.length===J.length&&W.every((function(e,t){return e===J[t]})),n.options&&n.options.highlightCorrect&&_.forEach((function(e,t){e.textContent.trim()===J[t]?kInteractive.c.addClass(e,"correct"):kInteractive.c.addClass(e,"incorrect")}))}else t.c[l].a&&(i.correctResponses=t.c[l].t),a[l].checked&&(i.learnerResponses=t.c[l].t),(a[l].checked&&!t.c[l].a||!a[l].checked&&t.c[l].a)&&(c=!1),n.options&&n.options.highlightCorrect&&t.c[l].a&&kInteractive.c.addClass(a[l].parentNode,"correct");return i.correct=c,i},checkTimeValidity:function(e,t){var n=kInteractive.phpDateToJS(e),i={};function a(e){var t=e.split(":");return 1==t[0].length&&(t[0]="0"+t[0]),1==t[1].length&&(t[1]="0"+t[1]),t[0]+":"+t[1]}if(!t.fromDate){var r=function(e){return String(e+100).substr(1)},s=r(n.getHours())+":"+r(n.getMinutes());return s>a(t.toTime)?i.expired=!0:s<a(t.fromTime)?i.early=!0:i.valid=!0,i}var o=t.fromDate.split("-"),c=t.fromTime.split(":"),l=new Date(o[2],o[1]-1,o[0],c[0],c[1]),d=t.toDate.split("-"),u=t.toTime.split(":");return n>new Date(d[2],d[1]-1,d[0],u[0],u[1])?i.expired=!0:n<l?i.early=!0:i.valid=!0,i},sendPost:function(e,t,n){t||(t={});var i=new XMLHttpRequest;n&&(i.onreadystatechange=n),i.open("POST",e),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var a="a=a";for(var r in"undefined"!=typeof uuid&&(a+="&fingerprint="+uuid),t){var s=t[r];null!=s&&("object"!=_typeof(s)&&("string"==typeof s&&(s=encodeURIComponent(s)),"boolean"==typeof s&&(s=s?1:0),a+="&"+r+"="+s))}i.send(a)},replaceWithError:function(e,t){t||(t={}),this.stopClock(e);var n=e.getElementsByClassName("scoreHistory")[0],i=e.getElementsByTagName("h4")[0],a=kInteractive.readData(e);e.innerHTML="";var r=document.createElement("div");a.style&&kInteractive.c.addClass(r,a.style),e.appendChild(r),i&&!a.options.hideTitleOnError&&r.appendChild(i);var s=document.createElement("div"),o=t.tag;o||(o="p"),s.innerHTML="<"+o+" class='"+t.className+"'>"+t.msg+"</"+o+">",r.appendChild(s.children[0]),n&&r.appendChild(n)},phpDateToJs:function(e){var t=(e=(e=(e=e.split("+")[0]).split(".")[0]).replace("T"," ")).split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5])},stopClock:function(e){e&&e.clock&&(e.clock.pause(),e.clock.destroy(),e.clock=null)},getAttempts:function(e,t){if(kInteractive.readData(e).options.serverReports&&kInteractive.isKotobeeUser()){var n=(config.kotobee.liburl?config.kotobee.liburl:"https://www.kotobee.com/")+"admin/library/questions/get",i=angular.element(document.body).scope(),a={env:"library"==config.kotobee.mode?"library":"book",cloudid:config.kotobee.cloudid,email:i.data.user.email,code:i.data.user.code,pwd:i.data.user.pwd,qsxid:e.id,mode:"submissions"};"library"==config.kotobee.mode&&i.data.book&&(a.bid=i.data.book.id),kInteractive.questions.f.sendPost(n,a,(function(e){var n=e.target;if(4===n.readyState&&200===n.status){var i=0;try{var a=JSON.parse(n.responseText);i=Number(a.scores.length)}catch(e){}t(i)}}))}else kotobee.getData({label:e.id+"-attempts"},(function(e){if(!e||!e.length)return t(0);t(Number(e[0].data))}))},clearSavedAnswers:function(){for(obj in document)0==obj.indexOf("ki-qs-")&&delete document[obj]},manualDrag:{isDown:null,startX:null,startY:null,currentX:null,currentY:null,walkX:null,walkY:null,margin:0,currentAnswerObj:{},answersContainers:[],store:null,dragStart:function(e){e.stopPropagation(),this.isDown=!0;var t=(e=e||window.event).target;this.getContainers(t);var n=t.getElementsByTagName("span")[0];n&&(n.style.pointerEvents="none"),t.style.zIndex="999",this.startX=Math.round(e.touches[0].clientX)-this.margin,this.startY=Math.round(e.touches[0].clientY)-this.margin,this.dragEnd(t)},dragEnd:function(e){e.addEventListener("touchend",(function(){function t(){return kInteractive.questions.f.manualDrag}t().isDown=!1,e.style.left="initial",e.style.top="initial",e.style.zIndex="initial",null!==t().store&&t().store.container.append(t().store.answer)}))},dragMove:function(e){var t=(e=e||window.event).target;this.currentAnswerObj=t.getBoundingClientRect(),this.isDown&&(this.currentX=Math.round(e.touches[0].clientX)-this.margin,this.currentY=Math.round(e.touches[0].clientY)-this.margin,this.walkX=this.currentX-this.startX,this.walkY=this.currentY-this.startY,t.style.left=this.walkX+"px",t.style.top=this.walkY+"px",this.detectBoundaries(t))},detectBoundaries:function(e){function t(){return kInteractive.questions.f.manualDrag}this.answersContainers.forEach((function(n){if(n){var i=n.getBoundingClientRect(),a={w:i.width,h:i.height,x:i.x,y:i.y},r={w:t().currentAnswerObj.width,h:t().currentAnswerObj.height,x:t().currentAnswerObj.x,y:t().currentAnswerObj.y};kInteractive.questions.f.manualDrag.hasIntersection(r,a)&&(t().store={container:n,answer:e})}}))},hasIntersection:function(e,t){return!(e.y+0>t.y+t.h)&&(!(e.x+e.w+0<t.x)&&(!(e.y+e.h+0<t.y)&&!(e.x+0>t.x+t.w)))},getContainers:function(e){function t(){return kInteractive.questions.f.manualDrag}var n=e.parentElement,i=n?n.className:"";if(i.includes("ki-dd-answers"))a(n.parentElement.getElementsByClassName("categoryContainer")[0]);else if(i.includes("dCategory")){a(n.parentElement)}function a(e){if(n&&e){var i=e.getElementsByClassName("dCategory");i.length&&(t().answersContainers=Array.from(i))}else t().answersContainers=[]}},isIOS:function(){return"undefined"!=typeof isKotobee&&"undefined"!=typeof ios&&ios}}};